---
title: "ETC5521 Assignment 1"
subtitle: "Your title"
team: goanna
author:
  - XUE WANG
  - XITONG HE
  - CUIPING WEI
bibliography: references.bib
biblio-style: authoryear-comp
link-citations: yes
linestretch: 2
date: "`r Sys.Date()`"
output: 
  bookdown::html_document2: 
  theme: paper
  citation_package: biblatex
---
[This assignment is for ETC5521 Assignment 1 by Team `r rmarkdown::metadata$team` comprising of `r knitr::combine_words(rmarkdown::metadata$author)`.]{style="color:#006DAE;"}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, messages=FALSE, warning=FALSE, fig.pos = 'H', fig.align ='center')
```

```{r load-libraries, message=FALSE}
library(readr)
library(tidyverse)
library(here)
library(viridis)
library(leaflet)
library(knitr)
library(lubridate)
library(rgdal)
library(hrbrthemes)
library(xts)
library(dygraphs)
library(dplyr)
library(leaflet)
library(sf)
library(kableExtra)
library(raster)
library(ggplot2)
library(GGally)
```



# Introduction and motivation

Bushfires that raged in Australia from September 2019 to early 2020 captured the attention of people worldwide, especially the out-of-control bushfires in New South Wales. However, looking at the Australian bushfires' history data, we can find that Australia suffers from different degrees and quantities of bushfires every year. It is exciting to explore the link between Australian fire history and climate change. What climate conditions caused the frequent occurrence of the bushfires in Australia?    
This analysis aims to explore three secondary questions for the primary research question:   
- When and where were the most widespread fires burning?   
- Was temperature to be blamed for bushfires in Australia?   
- Was rainfall to be blamed for bushfires in Australia?  
  
The rest of the analysis proceeds as follows. Section 2 presents the data description. Section 3 details the findings in data analysis. The limitations of the analysis are presented in Section 4. Finally, Section 5 provides the conclusions of this analysis.   

# Data description

This section mainly introduces the data, data sources and data description.  
There are three data sets used on this analysis, and the cleaned data is obtained from [GitHub tidytuesday](https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-01-07/readme.md).  

```{r read-data}
# please find the data cleaning code in *data-cleaning code script.R*
nasa_fire <- readr::read_csv(here::here("data/2020-01-07/fire_archive_M6_147063.csv")) %>% select(-instrument,-type)
temperature <- read.csv(here::here("data/2020-01-07/temperature_new.csv"))
rainfall <- read.csv(here::here("data/2020-01-07/rainfall_new.csv"))
```

## Australua fire data

The `fire` data source is from [NASA](https://firms.modaps.eosdis.nasa.gov/download/)[@nasa] "Active Fires Dataset" via the MODIS fire product collection. MODIS active fire product is detected the fire data in every 5 minutes and collected through each tile with horizontal and vertical coordinate. The data contains the fire information of Australia with `r nrow(nasa_fire)` observations from 2000-11-01 to 2020-01-05. The variables information included in the data are as the following table:  

```{r fire-data, message=FALSE}
fire_data <- data.frame(
  Variable = c("latitude", "longitude", "brightness", "scan", 
               "track", "acq_date", "act_time", "satellite", 
               "confidence", "version", "dbright_t31","frq", "day_night"),
  Description = c("Center of 1km fire pixel but not necessarily the actual location of the fire as one or more fires can be detected within the 1km pixel.", 
                  "Center of 1km fire pixel but not necessarily the actual location of the fire as one or more fires can be detected within the 1km pixel.", 
                  "Channel 21/22 brightness temperature of the fire pixel measured in Kelvin.", 
                  "The algorithm produces 1km fire pixels but MODIS pixels get bigger toward the edge of scan. Scan and track reflect actual pixel size.", 
                  "The algorithm produces 1km fire pixels but MODIS pixels get bigger toward the edge of scan. Scan and track reflect actual pixel size.",
                  "Date of MODIS acquisition.",
                  "Time of acquisition/overpass of the satellite (in UTC).",
                  "A = Aqua and T = Terra.",
                  "This value is based on a collection of intermediate algorithm quantities used in the detection process. It is intended to help users gauge the quality of individual hotspot/fire pixels. Confidence estimates range between 0 and 100% and are assigned one of the three fire classes (low-confidence fire, nominal-confidence fire, or high-confidence fire).",
                  "Version identifies the collection (e.g. MODIS Collection 6) and source of data processing: Near Real-Time (NRT suffix added to collection) or Standard Processing (collection only). '6.0NRT' - Collection 6 NRT processing.'6.0' - Collection 6 Standard processing. Find out more on collections and on the differences between FIRMS data sourced from LANCE FIRMS and University of Maryland.",
                  "Channel 31 brightness temperature of the fire pixel measured in Kelvin.", 
                  "Depicts the pixel-integrated fire radiative power in MW (megawatts).",
                  "D = Daytime, N = Nighttime"))

fire_data %>%
  kable(caption = "Australia fire data") %>%
  kable_styling(bootstrap_options = "striped", 
                full_width = F, 
                position = "left")
```

 
## Climate data

For climate data, temperature and rainfall was gathered from the Australian [Bureau of Meterology (BoM)](http://www.bom.gov.au/?ref=logo), of which is used the weather station to measure a variety of aspects of the weather. 
The `Rainfall` data was sourced from six major Australian cities: Perth, Adelaide, Melbourne, Sydney,Brisbane and Canberra, and the cleaned data is obtained from [GitHub tidytuesday](https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-07/rainfall.csv), which is from 1858-01-01 to 2020-01-06, containing more than 230,000 observations.In order to maintain the complete information in six cities, we expand the information for Brisbane and Canberra from the [source website](http://www.bom.gov.au/climate/data) and cleaned them to obtain the data from 1968-01-01 to 2017-12-31 in Canberra and from 1893-01-01 to 1998-12-31 in Brisbane. The new rainfall data is constructed by the old one and supplemental one and then become the final rainfall data set.
The `temperature` data is divided into two parts, with the cleaned data obtained directly from [GitHub tidytuesday](https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-07/temperature.csv), which is from 1910-01-01 to 2019-05-31. And we found the time range of the cleaned `temperature` data cannot match the `fire` data, in order to further analysis of the relationship between the fire and the temperature, we decided to download the new temperature data from the [source website](http://www.bom.gov.au/climate/data/index.shtml??zoom=1&lat=-26.9635&lon=133.4635&layers=B0000TFFFFFFFFFTFFFFFFFFFFFFFFFFTTT&dp=IDC10001&p_nccObsCode=201&p_display_type=dailyDataFile), and cleaned it to obtain the new data from 2019-06-01 to 2020-01-05. Finally, the new data were merge with the Github data to produce a final `temperature` data from 1910-01-01 to 2020-01-05,consisting of more than 530,000 observations. Also, there are seven weather stations were chosen, based on seven Australian cities such as  Perth, Adelaide, Melbourne, Sydney, Brisbane, Port Lincoln and Canberra.  

The climate data structure is shown as the below tables.

```{r temp-data, message=FALSE}
temperature_data <- tibble(Variable = c("city_name", "date", "temperature", "temp_type", "site_name"),
                          Class = c( "character",  "double", "double","character", "character"),
                          Description = c("City Name", 
                                          "Date", 
                                          "Temperature in Celsius", 
                                          "Temperature type (min/max daily)", 
                                          "Actual site/weather station")) 
temperature_data %>%
  kable(caption = "Temperature data") %>%
  kable_styling(bootstrap_options = "striped", 
                full_width = F, 
                position = "left")
```

```{r rainfall-data, message=FALSE}
rainfall_data <- data.frame(Variable = c("station_code",
                              "city_name",
                              "year",
                              "month",
                              "day",
                              "rainfall",
                              "period",
                              "quality",
                              "lat",
                              "long",
                              "station_name"),
                          Class = c("character", "character", "double",
                                    "character","character", "double", 
                                    "double","character","double","double", "character"),
                          Description = c("Station Code",
                                          "City Name", 
                                          "year",
                                          "month",
                                          "day",
                                          "Trainfall in millimeters", 
                                          "how many days was it collected across",
                                          "	Certified quality or not",
                                          "latitude",
                                          "longitude",
                                          "Station Name")) 
rainfall_data%>%
  kable(caption = "Rainfall data") %>%
  kable_styling(bootstrap_options = "striped", 
                full_width = F, 
                position = "left")
```

# Analysis and findings

## When were the most fires burning ?

In this part, we will focus on the relationship between fire number and the time, We analyzed the fire data of the past ten years and got the total number of living in 12 months of each year, the graph shows below.  

```{r when,fig.cap="The number of Australia fire in 12 month between 2001 and 2020"}

data_fire_Year <- nasa_fire %>% 
  
  mutate(acq_date = as.POSIXlt(acq_date)) %>% 
  mutate(Year =year(acq_date),Month = month(acq_date)) %>% 
  mutate(Year = factor(Year)) %>% 
  group_by(Year,Month)%>% 
  summarise(total = n()) 

p1 <- data_fire_Year %>% 
  mutate( highlight=ifelse(Year=="2019", "2019", "Other")) %>% 
  ggplot( aes(x=Month, y=total, group=Year, color=highlight, size=highlight)) +
  scale_x_continuous(breaks = seq(1, 12, by = 1))+
  geom_line()+
  geom_label( x=4.5, y=2000, label="Other years,2001 to 2018", size=2, color="#69b3a2")+
  geom_label( x=11.5, y=90000, label="2019", size=3, color="#69b3a2")+
  geom_label( x=8.5, y=115000, label="2011", size=3, color="#69b3a2")+
  scale_color_manual(values = c("#69b3a2", "grey")) +
    scale_size_manual(values=c(1.5,0.2)) +
    theme(legend.position="none") +
    # ggtitle("The number of Australia fire in 12 month between 2001 and 2020") +
  theme(
                  axis.text.y = element_text(color = "grey", 
                                             face = "bold"),
                  plot.title = element_text(face = "bold"),
                  plot.background = element_rect(fill="white"),
                  panel.background = element_rect(fill="white"))
 
p1
```
Figure ref\@{figure:when} represent the changing trend of the total number of fires from 2001 to 2020. From this figure, there are three unusual phenomena.  

Firstly, Why is the fire trend in 2019 different from other years? we can know that 2019-fire is the largest fire in Australia's temperate forests since European settlement[@nolan2020causes], why it happens? This is because before and during the current fire season, eastern Australia has been suffering from severe drought. In particular, in the six months ending November 30, 2019, most of the northeastern part of New South Wales had the lowest rainfall in history and the temperature was above average.

Secondly, Why is the number of fires from August to November significantly higher than in other months? Is it because of the temperature? August to November is Australia's winter and spring. The average temperature is not particularly high, but fall and winter bring drier weather, making the grass dry and ready to catch fire[@sullivan2012fuel]. Is it also because of rainfall? We drew a figure ref\@{figure:rain} of the average rainfall of different months between 2001 and 2020. It is obvious that September and October are the months with the least rainfall, and August and November are not particularly rainy, so August to November, One of the reasons for the high number of wildfires relative to other months is the low rainfall.

```{r rain, fig.cap ="Average rainfall in different months"}
rain_agv <- rainfall %>% 
  filter(year> "2001") %>% 
  #mutate(date = as.Date(date)) %>% 
  #mutate(Month = month(date)) %>% 
  group_by (month) %>% 
  #filter(Month ==c(8:11)) %>% 
  summarise(mean_rain= mean(rainfall,na.rm=TRUE)) %>% 
  arrange(mean_rain)
  
  rain_agv %>%
 # filter(!is.na(Value)) %>%
  arrange(mean_rain) %>%
  mutate(month=factor(month, month)) %>%
  ggplot( aes(x=month, y=mean_rain) ) +
    geom_segment( aes(x=month ,xend= month, y=0, yend=mean_rain), color="grey") +
    geom_point(size=3, color="#69b3a2") +
    coord_flip() +
    #theme_ft_rc() +
    theme_ipsum() +
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="none"
    ) +
    xlab("Month")
```

Lastly, Why did September with the highest number of fires occur in 2011? This is because the fire swept through the Barkley Plateau and the Victoria River area, destroying large areas of grazing land. According to the report, the fire front is estimated to be 50 kilometers (31 miles); the Barkley fire caused 7,000 square kilometers (2,700 square miles) to be burned in the country, and the Victoria River area lost 2,000 square kilometers (770 square miles). At the same time, 30 grass fires broke out in Kimberley. Several other fires burned in Kimberley, causing the loss of 60,000 hectares (150,000 acres) of grassland. (source: https://en.wikipedia.org/wiki/2011%E2%80%9312_Australian_bushfire_season#cite_note-3)



## What locations the most widespread fires burning?

Wildfires in Australia have always existed for the past ten years. In this section, we will focus on the relationship between wildfires and geographic locations. Because the data downloaded from NASA does not contain information about the specific state of each wildfire, so I will first divide data into different states according to the latitude and longitude. Since the borders of New South Wales and Victoria are not easily distinguished, putting these two states together, we can finally get the wildfire situation in different states in the past ten years.

```{r state,fig.cap=" The number of wildfire in different states in the past ten years"}

WA_fire <- nasa_fire %>% 
  filter(longitude < 128) %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "WA")

NT_fire <- nasa_fire %>% 
  filter(longitude < 138, latitude < '-25')  %>% 
  filter(128<longitude) %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "NT") 

SA_fire <- nasa_fire %>% 
  filter(longitude < 141, latitude > '-25')  %>% 
  filter(128<longitude) %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "SA") 

QLD_1 <- nasa_fire %>% 
  filter(longitude > 141, latitude < '-25')  %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "QLD") 

QLD_2  <- nasa_fire %>% 
  filter(longitude > 141, latitude < '-29')  %>% 
  filter(latitude >'-26') %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "QLD")


VIC_NSW  <- nasa_fire %>% 
  filter(longitude > 141, latitude > '-29')  %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "VIC_NSW") 

state_fire <- bind_rows(WA_fire,NT_fire,SA_fire,VIC_NSW ,QLD_1,QLD_2) %>% 
  group_by (state,Year) %>% 
  summarise(total= n())
ggplot(state_fire,aes(x = Year,y = total)) +
  geom_col(color = "#69b3a2")+
  facet_wrap(~state)+
   theme(axis.text.y = element_text(color = "grey", 
         face = "bold"),
        plot.title = element_text(face = "bold"),
         plot.background = element_rect(fill="white"),
        panel.background = element_rect(fill="white"))
 
```
The fig\@{figure:state} clearly shows the largest number of fires almost happen in the Northern Territory and Queensland, one of the reasons is because the Northern Territory and Queensland have more forests. When it comes to the VIC_NSW, Since 2001, the number of fires has remained the same overall, except for 2019, which the number of fires has  When we focus on the year of 2019, we can see that, in some regions, the data in 2019 is indeed slightly higher than the surrounding years, the reason will explain in next part.

## The higher the temperature, the more bushfires

Were bushfires more likely to happen with higher temperatures in Australia? In this section, we will explore the relationship between the two in-depth.   

```{r temp}
temperature <- temperature %>% 
  mutate(year = year(date)) 
```

```{r temp-yearly}
# calculate annual mean temperature
temp_year <- temperature %>% 
  filter(temp_type == "max") %>% 
  filter(year <= 2019) %>% 
  group_by(year) %>% 
  summarise(avg = mean(temperature,na.rm = TRUE)) %>% 
  mutate(time = paste0(year, "-01-01"),
         time = as.Date(time)) 
```

```{r temp-yearly-plot,message=FALSE, warning=FALSE, fig.cap="Annual average temperature trends from 1910 to 2019, calculated by daily maximum temperature"}
# prepare time series data
temp_year_dat <- xts(x = temp_year$avg, order.by = temp_year$time)

# time series plot
dygraph(temp_year_dat) %>%
  dyOptions(labelsUTC = TRUE, 
            fillGraph=TRUE, 
            fillAlpha=0.15, 
            drawGrid = FALSE, 
            colors="#EED5D2") %>%
  dyRangeSelector(dateWindow = c("2000-01-01", "2019-01-01"),
                  height = 50,
                  fillColor = "#BFEFFF",) %>%
  dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightCircleSize = 5, 
              highlightSeriesBackgroundAlpha = 0.1, 
              hideOnMouseOut = FALSE)  %>%
  dyRoller(rollPeriod = 1)

```


As a first step, we calculated the annual average temperature from 1910 to 2019 and drew a time series plot. From the Figure \@ref(fig:temp-yearly-plot), it can be seen that the average temperature in 2019 is significantly higher than in other years. A strong positive Indian Ocean Dipole (IOD) phenomenon was the culprit[@harris2019understanding], and contributed to very high temperature and low rainfall across Australia[@bureau2019annual], which began in May 2019 and lasted until the end of the year.   

```{r plot1, fig.cap= 'Indian Ocean Dipole: positive phase. Source from Australian BOM.', out.width = '60%', out.height='60%'}
knitr::include_graphics("images/iod-positive.png")
```
  
However, how big is the difference between the temperature in 2019 and other years? Has it reached dangerous standards?   
Therefore, we calculated the annual average temperature from 1961 to 1990, which is the baseline used by the Australian BOM to compare annual average temperature difference. From the Figure \@ref(fig:temp-diff), we can find that from 1910 to mid-1950, the annual average temperature of almost all years was lower than the baseline, but since the late 1950s, it was higher than the baseline. Although there have been sporadic years of unusual trends, it does not affect the overall trend. Also, it is worth noting that 2019 is significantly higher than in other years, with a difference of above 1.5 degrees Celsius. As BOM sates, 2019 was Australia's warmest year on record, surpassing the previous record of +1.35°C in 2013[@bureau2019annual].  
Since the 1970s, the rising average annual temperature has been a warning that Global warming is a growing problem. Moreover, Global warming brings many catastrophic disasters, among which bushfires are one of them. As the global temperature rises more, humans and nature will encounter more disasters. The average temperature in Australia has risen by 1 degree Celsius since the industrial period, which is one of the reasons why bushfires were so frequently occurred in Australia and raged in 2019[@council2019not].   

```{r baseline}
# mean temperature from 1961 to 1990, follow the baseline selected by the Australian BOM
meanTemp <- temperature %>% 
  filter(temp_type == "max") %>% 
  filter(year >= 1961 & year <= 1990) %>% 
  summarise(avg = mean(temperature, na.rm = TRUE))
```

```{r themes}
# combine themes
themes_p <- theme(axis.title.x=element_blank(),
                  axis.title.y=element_blank(),
                  axis.ticks=element_blank(),
                  axis.text.x = element_blank(),
                  axis.text.y = element_text(color = "grey", 
                                             face = "bold"),
                  plot.title = element_text(face = "bold"),
                  plot.background = element_rect(fill="white"),
                  panel.background = element_rect(fill="white"))
```

```{r temp-diff, message=FALSE,warning=FALSE, fig.cap="The plot for the difference between the average temperature of 1961-1990(as baseline) and the annual average temperature for each year from 1910 to 2019, calculated by daily maximum temperature"}
# temperature difference data
temp_diff <- temperature %>%
  filter(temp_type == "max") %>% 
  filter(year <= 2019) %>% 
  group_by(year) %>% 
  summarise(avg = mean(temperature,na.rm = TRUE)) %>% 
  mutate(diff = (avg - meanTemp$avg),
         diff = round(diff,2))

temp_diff$ismax <- with(temp_diff, ave(diff, FUN=function(x) x==max(x)))

# plot difference
temp_diff %>% 
  ggplot(aes(year, diff, fill=as.factor(ismax))) + 
  geom_bar(stat="identity") +
  scale_y_continuous(breaks = seq(-1.5,1.5,0.5))+
  scale_fill_manual(breaks=c("0","1"), 
                    values=c("#C7C7C7","#F08080"), 
                    guide="none")+
  geom_hline(yintercept = 0, color = "#9C9C9C")+
  annotate(geom="text", 
           x=1930, y=0.8, 
           label="Annual temperature's difference \n with the 1961–1990 average",
           color="grey", 
           size = 3)+
  annotate(geom="text", 
           x=1917, y=1.5, 
           label="above than average(°C)",
           color="grey", 
           size = 3)+
  annotate(geom = "text",
           x=2019,y=1.8,
           label="2019",
           size = 3)+
  annotate(geom = "text",
           x=1917,y=-1.9,
           label="1917",
           size = 3)+
  annotate(geom = "text",
           x=1972,y=0.5,
           label="1970",
           size = 3)+
  ggtitle("2019 was Australia's hottest year")+
  themes_p

```

```{r fire-year-sum}
# calculate annual mean temperature
sum_fire <- nasa_fire %>% 
  mutate(year = year(acq_date)) %>% 
  filter(year > 2000 & year <= 2019) %>% 
  group_by(year) %>% 
  summarise(n = n()) %>% 
  mutate(time = paste0(year, "-01-01"),
         time = as.Date(time)) 
```

```{r fire-yearly-plot, fig.cap="Annual total fires trends from 2001 to 2019"}
# prepare time series data
fire_year_dat <- xts(x = sum_fire$n, order.by = sum_fire$time)

# time series plot
dygraph(fire_year_dat) %>%
  dyOptions(labelsUTC = TRUE, 
            fillGraph=TRUE, 
            fillAlpha=0.15, 
            drawGrid = FALSE, 
            colors="#EED5D2") %>%
  dyRangeSelector(dateWindow = c("2000-01-01", "2019-01-01"),
                  height = 50,
                  fillColor = "#BFEFFF",) %>%
  dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightCircleSize = 5, 
              highlightSeriesBackgroundAlpha = 0.1, 
              hideOnMouseOut = FALSE)  %>%
  dyRoller(rollPeriod = 1)
```

Figure \@ref(fig:fire-yearly-plot) shows the annual trend of total number of fires in Australia from 2001 to 2019. Compared with Figure \@ref(fig:temp-yearly-plot), the annual total fire occurrences trend fluctuates mostly in a consistent pattern. When the temperature is high, there are generally more fires, and vice versa. However, there are an unexpected fact that the fires occurrence in 2012 ranked first with 474,964, but the annual average temperature in 2012 was relatively low with 22.57°C. We found that the raged bushfires in 2012 that were caused by lightning at the beginning, and lightning was predominantly responsible for the bushfires[@dowdy2012characteristics].   
  
From the above analysis, we can further clarify that the high-temperature weather in 2019 is closely related to bushfires, and high temperature makes forest fuels more susceptible to cause bushfires[@oldenborgh2020attribution].   

```{r temp-site, message=FALSE}
temperature %>% 
  filter(date >= "2019-09-01") %>%
  group_by(city_name) %>% 
  summarise(avg = mean(temperature, na.rm = TRUE)) %>% 
  arrange(-avg) %>% 
  kable(caption = "Average annual temperature for each city in 2019") %>% 
  kable_styling(bootstrap_options = 
                  c("striped", "condensed"), 
                  full_width = F, 
                  position = "center")
```

```{r fire-map, message = FALSE, fig.cap="The distribution point for Australian bushfire from 2019-12-29 to 2020-01-05(the darker the color, the more serious the fire)"}
subset <- nasa_fire %>% 
  filter(acq_date == "2019-12-01")

pal <- colorNumeric(palette = "YlOrRd", domain = subset$brightness)

leaflet(data = subset) %>%
   #setView(lng = 153.05, lat = -27.45, zoom = 12) %>% 
    addTiles() %>%
    addCircleMarkers(lat = ~latitude, 
                     lng = ~longitude, 
                     popup = ~brightness, 
                     radius=4,
                     color = ~pal(brightness), 
                     stroke = FALSE, 
                     fillOpacity = 0.6) %>%
    addLegend(position = "bottomleft", pal = pal, values = ~brightness)

```

In this part of the analysis, we concluded that as global warming becomes more serious and temperatures rise, bushfires will become more frequent.   


# The less rainfall, the more bushfire.

Has the less rainfall affected the more fire in Australia? Or Has the more rainfall influenced the less rainfall? In the past few months,Australia has been suffered a huge fire especially in the winter. Because of the location of Australia, the rainfall in Australia is highly variable which is strongly influenced by global climate system phenomena such as El Niño, La Niña, and the Indian Ocean Dipole. In spite of this large natural variability, the potential long-term trends are evident in some regions,even effecting the local rainfall. In this section, we will explore what is the relationship between rainfall and fire case whether they are positive or negative relationship and what is the reason raised to this issue?

```{r load-data-rain}
rain<-read.csv(here::here("data/2020-01-07/rainfall_new.csv"))
nasa_fire<-read.csv(here::here("data/2020-01-07/fire_archive_M6_147063.csv"))
temp<-read.csv(here::here("data/2020-01-07/temperature_new.csv"))

```


## The annual rainfall situation in Australia

As a first step, we analyze the overall situation of annual rainfall. In the rainfall dataset,there are including six cities, of which Sydney has been recorded the rainfall data from 1850 compared with other places and most of place started from around 1970. Therefore, we selected the rainfall data from 1970 for using same scale in the year variable. In order to calculate the annual average rainfall situation, using the six cities which are from six regions in Australia to estimate the overall annual average rainfall. To evaluate the baseline of annual rainfall which is based on the BOM by selecting from 1961 to 1990 to construct the baseline(@bureau2019annual).

The figure \@ref(fig:rain-yearly-plot) shows that how the annual rainfall have changed over time in Australia. An extremely severe drought occurred in the 1994 and this drought was influenced by a strong El Niño weather pattern, the fifth continuous year of drought in parts of Australia(@nicholls2004changing). Although the variability of natural weather in Australia is large,in the recent 20 years,2019 became the driest year. One reason is that the strongest positive Indian Ocean Dipole event (pIOD) has recorded the highest values across 60 years,and due to the frequency and influence of sea-surface temperature changes,the El Nino-Southern Oscillation (ENSO) is neutral throughout the year. Because of the pIOD,it severely curtailed the Walker Circulation and abnormal easterly winds appear in the Indian Ocean and prevailing winds in northwest Australia blow from the continent to the ocean. These winds swept away large amounts of cloud cover over Australia, so the rainfall has been declined dramatically based on that(@hughes2003climate). Also, the annual rainfall in 2010 was the highest in 20 years which is the wettest year since 2000 because of the climate system such as La Niña events.

According to the figure \@ref(fig:rain-diff-annual),the annual rainfall changed cross time compare with the average baseline. The overall situation is that the rainfall difference of most of years are below the average especially for the last 20 years. Even though the annual rainfall difference is above the baseline but it is still above a few in 2010 and 2011. In addition, 2019 is still the lowest rainfall difference in the recent 20 years.

```{r rainfall-wrangling-data}
rain<-rain%>%
 drop_na()%>%
  dplyr::select(station_code,year,rainfall,city_name)%>%
  filter(station_code %in% c("9151","23001","40913","66062","70351","86232"))%>%
  filter(year>=1970&year<=2019)
```


```{r rain-year-sum}
# calculate annual mean temperature
annual_rain <- rain %>% 
  dplyr::select(year,rainfall)%>%
  group_by(year) %>% 
  summarise(total=sum(rainfall))%>%
    mutate(time = paste0(year, "-01-01"),
         time = as.Date(time)) 
```

```{r rain-yearly-plot, fig.cap="Annual total rainfall trends from 2001 to 2019"}
# prepare time series data
rain_year_dat <- xts(x = annual_rain$total, order.by = annual_rain$time)

# time series plot
dygraph(rain_year_dat,main="Australia Annual Rainfall") %>%
  dyOptions(labelsUTC = TRUE, 
            fillGraph=TRUE, 
            fillAlpha=0.15, 
            drawGrid = FALSE, 
            colors="#EED5D2") %>%
    dyRangeSelector(dateWindow = c("2000-01-01", "2019-01-01"),
                  height = 50,
                  fillColor = "#BFEFFF",) %>%
  dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightCircleSize = 5, 
              highlightSeriesBackgroundAlpha = 0.1, 
              hideOnMouseOut = FALSE)  %>%
  dyRoller(rollPeriod = 1)%>%
  dySeries("V1", label = "Annual Rainfall (mm)")%>%
 dyAxis("y", label = "Rainfall / Year")
```

```{r baseline-rain}
#the annual rainfall baseline selected by the Australian BOM from 1961 to 1990
rainmean<-rain%>%
  dplyr::select(year,rainfall)%>%
  filter(year>=1970&year<=1990)%>%
  group_by(year)%>%
 summarise(avg=sum(rainfall))

rainmean<-rainmean%>%
  mutate(baseline=sum(avg)/120)
  
```


```{r rainfall-diff, message=FALSE}
#277.6 is the annual rainfall baseline selected by the Australian BOM from 1961 to 1990
rain_diff <- rain %>%
   dplyr::select(year,rainfall)%>%
  group_by(year) %>% 
  summarise(avg = sum(rainfall)/6)%>%
  mutate(diff = (avg - rainmean$baseline ),
         diff = round(diff,2))
```

```{r rain-diff-annual,fig.cap="Annual rainfall difference"}
rain_diff$ismax <- with(rain_diff, ave(year, FUN=function(x) x==max(x)))

ggplot(rain_diff,aes(x=year, y=diff,fill=as.factor(ismax))) + 
  geom_bar(stat = "identity")+
  scale_fill_manual(breaks=c("0","1"), values=c("grey","red"), guide="none")+
   geom_hline(yintercept = 0, color = "#9C9C9C")+
  scale_y_continuous(breaks = seq(-400,400,100))+
  annotate(geom="text", 
           x=1985, y=250, 
           label="Annual rainfall difference \n with the 1961–1990 average",
           color="grey", 
           size = 3)+
  annotate(geom="text", 
           x=1975, y=350, 
           label="above than millimeters(mm)",
           color="grey", 
           size = 3)+
  annotate(geom = "text",
           x=2019,y=-300,
           label="2019",
           size = 3)+
  annotate(geom = "text",
           x=1994,y=-380,
           label="1994",
           size = 3)+
   annotate(geom = "text",
           x=2000,y=-220,
           label="2000",
           size = 3)+
  annotate(geom = "text",
           x=2010,y=100,
           label="2010",
           size = 3)+
  ylab("rainfall")+
  ggtitle("The annual rainfall difference in Australia from 1970 to 2019")+
  theme(axis.title.x=element_blank(),
                  axis.title.y=element_blank(),
                  axis.ticks=element_blank(),
                  axis.text.x = element_blank(),
                  axis.text.y = element_text(color = "grey", 
                                             face = "bold"),
                  plot.title = element_text(face = "bold"),
                  plot.background = element_rect(fill="white"),
                  panel.background = element_rect(fill="white"))

```

Based on figure \@ref(fig:fire), the number of fire in Australia has been fluctuated but the average of fire more than 250000 cases in each year in the last 20 years. Obviously,the number of total fire is the lowest one in 2010. That may be the annual rainfall is the highest in 2010 as well which can be contributed to relief dry conditions and reducing the fuel load leading. Excepting for 2012 which the fire maybe raised by dry thunderstorm, The another highest point is in 2002. In this case, by looking at the annual rainfall and rainfall difference, the overall situation of these two attributes are lower which are the third from bottom.

To explore the further relationship between rainfall,temperature and fire, the scatter-plot will be displayed as below Figure \@ref(fig:correlation). Based on the figure, it seems that the rainfall and fire has negative correlation,suggesting that the more rainfall and the less fire. On the contrary, the higher temperature and the more fire although the correlation between these two variable is slightly small, while the relationship between them still can be evaluated. Moreover, the rainfall will be declined when the temperature would get higher.Temperatures will impact the rate of evaporation, with higher temperatures leading to faster soil moisture loss.(@hausfather2018explainer) 

In conclusion, the main weather character of bushfire is hot and dry(@van2020attribution). The graph of annual rainfall and temperature show that the hottest and driest year is 2019 which also has the biggest forest fire in Australia as well. Therefore,as the combination of extremely dry and extremely hot conditions adds up to more powerful fires, indicating that declines in rainfall and increases in temperature have likely been a primary driver of increases in wildfire area burned.
  

```{r rainfall-annual-data}
rain_annual<-rain%>%
  drop_na()%>%
  filter(year>=2001&year<=2019) %>% 
  #mutate(date = paste0(year,"-",month,"-",day)) %>% 
  group_by(year) %>% 
  summarise(rainfall = sum(rainfall))%>%
  mutate(year=as.character(year))
```

```{r fire-annual-total}
fire_annual <- nasa_fire %>% 
  filter(acq_date >= "2001-01-01" & acq_date <= "2019-12-31") %>% 
  mutate(acq_date = as.POSIXct(acq_date)) %>% 
  mutate(year =year(acq_date),Month = month(acq_date),Day=day(acq_date)) %>% 
  mutate(year = as.character(year)) %>% 
  group_by(year)%>% 
  summarise(fire = n()) 
```


```{r temp-annual-data}
temp_annual <- temp %>% 
  mutate(year = year(date)) %>%
  mutate(year=as.character(year))%>%
  filter(temp_type == "max") %>% 
  filter(year>=2001&year <= 2019) %>% 
  group_by(year) %>% 
  summarise(temperature = mean(temperature,na.rm = TRUE))
 # mutate(time = paste0(year, "-01-01"),
  #       time = as.Date(time)) 
```


```{r all-data}
all_data <- fire_annual %>% 
  left_join(rain_annual, by = "year") %>% 
  left_join(temp_annual, by = "year") %>%
  mutate(log_fire = log1p(fire),
         log_rainfall=log(rainfall))
```

```{r lm}
fit <- lm (log_fire ~ temperature+log(rainfall),data =all_data)
```

```{r correlation,fig.cap="The correlation between rainfall,temperature and fire"}
GGally::ggpairs(all_data,c(2:4))+
  theme(legend.position = "none", 
        panel.grid.major = element_blank(), 
        axis.ticks = element_blank(), 
        panel.border = element_rect(linetype = "dashed", colour = "blue", fill = NA))
```


# Limitations of analysis

This section mainly introduces two main limitations of this analysis:   
- There is no regional division in the fire data. We have indistinctly divided seven states or regions according to Australia's longitude and latitude, which may lead to bias in the analysis results for location.   
- The temperature and rainfall data include only some major cities, and comparing with the fire data, the sample is too small. Therefore,  the analysis of the link between fires and climate data in Section 3 is not accurate and will cause deviation in results.  


# Conclusions



# Acknowlegments

The authors would like to thank all the contributors to the following R package: @tidyverse,  @ggplot2, @readr, @leaflet, @xts, @here, @base, @ggthemes, @dplyr, @dygraphs, @lulbridate, @ggally.

# References
