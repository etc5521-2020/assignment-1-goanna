---
title: "ETC5521 Assignment 1"
subtitle: "Australian bushfires: The effect of climatic condition"
team: goanna
author:
  - Chengzhi Ye
  - Emily Sheehan
  - Dea Avega Editya
bibliography: references.bib
biblio-style: authoryear-comp
link-citations: yes
linestretch: 3
date: "`r Sys.Date()`"
output: 
  bookdown::html_document2: 
    toc: yes
    toc_float:
      collapsed: true
      number_sections: false
    theme: paper
---
[This assignment is for ETC5521 Assignment 1 by Team `r rmarkdown::metadata$team` comprising of `r knitr::combine_words(rmarkdown::metadata$author)`.]{style="color:#006DAE;"}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, messages=FALSE, warning=FALSE, fig.pos = 'H', fig.align ='center')
```

```{r load-libraries, message=FALSE}
library(readr)
library(tidyverse)
library(here)
library(knitr)
library(lubridate)
library(ggplot2)
library(GGally)
library(dygraphs)
library(xts)
library(kableExtra)
library(leaflet)
library(hrbrthemes)
library(dplyr)
library(miceadds)
library(plotly)
library(RColorBrewer)
library(corrplot)
library(dichromat)

select <- dplyr::select
```

# Introduction and motivation

The Australian climate is generally hot and dry, which means that most regions can be affected by bushfires at anytime of the year [@bushfire]. Bushfires vary in their magnitude and temperature. Some bushfires can go on for days, weeks or even months. Some bushfires are out of control, while others can be contained.

Last year, the bushfires in Victoria and New South Wales captured the attention of people worldwide. They caused destruction and devastation for several months. Around 33 lives were lost, over 1 billion mammals died, and over 3,000 homes were destroyed [@bushfires-2020-faq]. 

This analysis hopes to understand the relationship between climactic conditions and bushfires, and determine whether climate change has influenced the number of bushfires. 

R has been used as the main tool for cleaning and analysis. The analysis proceeds as follows; the data description can be found in section \@ref(data), the limitations in section \@ref(limitation), the findings in section \@ref(analysis) and the conclusion is in section \@ref(conclusion). 
  
## Research questions

The analysis has been divided into three parts; climactic condition, bushfires and the relationship between climatic condition and bushfires. 

Climactic condition:

* Where does rainfall occur most in Australia? **(NEW Q)**
* What is the hottest climate in Australia? **(NEW Q)**
* How has global warming impacted temperatures in Australia? **(NEW Q)**

Bushfires:

* In which months are bushfires burning?
* Where are the bushfires burning?

Relationship between climactic condition and bushfires:

* How does temperature and rainfall affect the number of bushfires?
* What is the correlation between climactic conditions and bushfires? **(NEW Q)** 

# Data description {#data}

This section mainly introduces the data, data sources and data description.   
There are three data sets used on this analysis, and the cleaned data is obtained from [GitHub tidytuesday](https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-01-07/readme.md).  

```{r read-data, warning=FALSE, message=FALSE}
# please find the data cleaning code in *data-cleaning code script.R*
# nasa_fire <- readr::read_csv(here::here("data/2020-01-07/fire_archive_M6_147063.csv")) %>% select(-instrument,-type)

#write to rds dataset to make it smaller
#save(nasa_fire, file = "nasa_fire.Rdata")
# load data .Rdata

nasa_fire <- load.Rdata2(filename = "nasa_fire.Rdata")


temperature <- read.csv(here::here("data/2020-01-07/temperature_new.csv"))
rainfall <- read.csv(here::here("data/2020-01-07/rainfall_new.csv"))
```

## Australian Fire Data

The Australian `fire` data has been extracted from the MODIS fire product collection at [NASA](https://firms.modaps.eosdis.nasa.gov/download/)[@nasa]. The fire data is collected every five minutes and there are `r nrow(nasa_fire)` observations from 2000-11-01 to 2020-01-05. All the variables in the dataset have been presented in the table below. The variables predominantly used in this analysis are; latitude, longitude and acquisition date.

```{r fire-data, warning=FALSE, message=FALSE}
fire_data <- data.frame(
  Variable = c("latitude", "longitude", "brightness", "scan", 
               "track", "acq_date", "act_time", "satellite", 
               "confidence", "version", "dbright_t31","frq", "day_night"),
  Description = c("Center of 1km fire pixel but not necessarily the actual location of the fire as one or more fires can be detected within the 1km pixel.", 
                  "Center of 1km fire pixel but not necessarily the actual location of the fire as one or more fires can be detected within the 1km pixel.", 
                  "Channel 21/22 brightness temperature of the fire pixel measured in Kelvin.", 
                  "The algorithm produces 1km fire pixels but MODIS pixels get bigger toward the edge of scan. Scan and track reflect actual pixel size.", 
                  "The algorithm produces 1km fire pixels but MODIS pixels get bigger toward the edge of scan. Scan and track reflect actual pixel size.",
                  "Date of MODIS acquisition.",
                  "Time of acquisition/overpass of the satellite (in UTC).",
                  "A = Aqua and T = Terra.",
                  "This value is based on a collection of intermediate algorithm quantities used in the detection process. It is intended to help users gauge the quality of individual hotspot/fire pixels. Confidence estimates range between 0 and 100% and are assigned one of the three fire classes (low-confidence fire, nominal-confidence fire, or high-confidence fire).",
                  "Version identifies the collection (e.g. MODIS Collection 6) and source of data processing: Near Real-Time (NRT suffix added to collection) or Standard Processing (collection only). '6.0NRT' - Collection 6 NRT processing.'6.0' - Collection 6 Standard processing. Find out more on collections and on the differences between FIRMS data sourced from LANCE FIRMS and University of Maryland.",
                  "Channel 31 brightness temperature of the fire pixel measured in Kelvin.", 
                  "Depicts the pixel-integrated fire radiative power in MW (megawatts).",
                  "D = Daytime, N = Nighttime"))

fire_data %>%
  kable(caption = "Australia fire data") %>%
  kable_styling(bootstrap_options = 
                c("striped", "condensed"), 
                full_width = F, 
                position = "center")
```

## Climate data

The climate data was extracted from the Australian [Bureau of Meterology (BoM)](http://www.bom.gov.au/?ref=logo). The Bureau of Meterology is the weather station that measures rainfall, wind, temperature, etc. 

The cleaned `Rainfall` data was obtained from from [GitHub tidytuesday](https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-07/rainfall.csv). It has rainfall for six Australian cities, namely; Perth, Adelaide, Melbourne, Sydney, Brisbane and Canberra. It contains more than 230,000 observations and has been collected from 1858-01-01 to 2020-01-06. There was a few missing values for Brisbane and Canberra. To maintain the integrity of the data the missing values have been added from the [source website](http://www.bom.gov.au/climate/data) and cleaned so that the data is complete for Canberra (for 1968-01-01 to 2017-12-31) and Brisbane (for 1893-01-01 to 1998-12-31). Therefore, the rainfall dataset used in this analysis is a combination of the two above. 

The temperature data has been retrieved from two sources. The first source for temperature data was [GitHub tidytuesday](https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-07/temperature.csv), and it has been collected from 1910-01-01 to 2019-05-31. Since the dates for the cleaned `temperature` data was not consistent with the `fire` data, a second source was used. The second source for the temperature data was [source website](http://www.bom.gov.au/climate/data/index.shtml??zoom=1&lat=-26.9635&lon=133.4635&layers=B0000TFFFFFFFFFTFFFFFFFFFFFFFFFFTTT&dp=IDC10001&p_nccObsCode=201&p_display_type=dailyDataFile). This data was cleaned to obtain temperatures from 2019-06-01 to 2020-01-05. Both datasets were merged to produce the final dataset used for the analysis. The final dataset has around 530,000 observations taken from 1910-01-01 to 2020-01-05. The seven weather stations chosen were based on the seven Australian cities; Perth, Adelaide, Melbourne, Sydney, Brisbane, Port Lincoln and Canberra.

The structure of the climate data is presented in the table below. The year, city name and rainfall variables were mainly used for from the `rainfall` dataset and the date, temperature and temperature type were predominantly used from the `temperature` dataset.   

```{r temp-data, warning=FALSE, message=FALSE}
temperature_data <- tibble(Variable = c("city_name", "date", "temperature", "temp_type", "site_name"),
                          Class = c( "character",  "double", "double","character", "character"),
                          Description = c("City Name", 
                                          "Date", 
                                          "Temperature in Celsius", 
                                          "Temperature type (min/max daily)", 
                                          "Actual site/weather station")) 
temperature_data %>%
  kable(caption = "Temperature data") %>%
  kable_styling(bootstrap_options = "striped", 
                full_width = F, 
                position = "center")
```

```{r rainfall-data, message=FALSE}
rainfall_data <- data.frame(Variable = c("station_code",
                              "city_name",
                              "year",
                              "month",
                              "day",
                              "rainfall",
                              "period",
                              "quality",
                              "lat",
                              "long",
                              "station_name"),
                          Class = c("character", "character", "double",
                                    "character","character", "double", 
                                    "double","character","double","double", "character"),
                          Description = c("Station Code",
                                          "City Name", 
                                          "year",
                                          "month",
                                          "day",
                                          "Trainfall in millimeters", 
                                          "how many days was it collected across",
                                          "	Certified quality or not",
                                          "latitude",
                                          "longitude",
                                          "Station Name")) 
rainfall_data%>%
  kable(caption = "Rainfall data") %>%
  kable_styling(bootstrap_options = "striped", 
                full_width = F, 
                position = "center")
```

# Limitations of analysis {#limitation}

The main limitations of the dataset are concerned with the fire and climate data. 

There is no regional division in the fire data. Therefore, the data has been assigned to a state or reigion based on its longitude and latitude, which may lead to location bias in the analysis. (borders for NSW an VIc not easily distinguished)

The rainfall and temperature data has been recorded for some major cities, and the sample is relatively small when compared to the fire data. Therefore, the correlation between the fire and climate data in section \@ref(analysis) may not be precisely accurate as the temperature could be for a city which may be hundreds of kilometres away from the fire it has been correlated to. This may cause a deviation in the results. 

# Analysis and findings {#analysis}

## Climate Conditions

### Where does rainfall occur the most in Australia? 

```{r rainjitterplot, fig.cap ="Average monthly rainfall for 2019", warning=FALSE, message=FALSE}
rain_jitter <- rainfall %>% 
  filter(year == "2019") %>% 
  select(city_name, year, month, day, rainfall)
  
ggplot(data = rain_jitter,
       aes(x = factor(month),y = rainfall,color = rainfall)) + 
       scale_color_gradientn(colours=rev(brewer.pal(10,'Spectral'))) + 
       geom_jitter(shape=16,position=position_jitter(0.2),size=1.8) + 
       theme_ipsum() +
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="none") +
    xlab("Month")+
    ggtitle("Average monthly rainfall in 2019") +
       facet_wrap(~city_name)
```


Figure \@ref(fig:rainjitterplot) shows the average monthly rainfall in 2019 for Adelaide, Brisbane, Canberra, Melbourne, Perth and Sydney. From this chart it is evident that Sydney had the most rain throuhgout 2019. The amount of rainfall in each state varies from month to month, which is likely due to each state having slightly different weather patterns and seasons.

### Where is the hottest climate in Australia?

```{r temp}
temperature <- temperature %>% 
  mutate(year = year(date)) 
```

```{r heatmapdata, warning=FALSE}
temperature_year <- temperature %>%
  select(year, temp_type, city_name, temperature) %>%
  filter(temp_type == "max") %>%
  group_by(year,  city_name) %>% 
  summarise(average_temp = mean(temperature,na.rm=T))
```

```{r heatmap, fig.cap ="Daily Average Temperature for each State Overtime", warning=FALSE, message=FALSE}
ggplot(data=temperature_year, aes(x=year, y=city_name)) + 
        geom_tile(aes(fill = average_temp),colour = "white") + 
        scale_fill_gradientn(colours=rev(brewer.pal(20,'Spectral'))) + 
      theme(legend.title=element_blank(),axis.title.y=element_blank(),axis.title.x=element_blank(),axis.text.x = element_text(angle=45, hjust=1), legend.position="top") +
       ggtitle("Temperature (daily average)") +
  theme_bw()

```
Figure \@ref(fig:heatmap) is a heatmap displaying the daily average temperature for each cities. It is clear that the warmest cities are Brisbane and Perth on average. Alarmingly, each area/city is increasing in temperature overtime, which is clear evidence of global warming. 

### How has climate change impacted weather patterns in Australia?

```{r temp-yearly, warning=FALSE, message=FALSE}
# calculate annual mean temperature
temp_year <- temperature %>% 
  filter(temp_type == "max") %>% 
  filter(year <= 2019) %>% 
  group_by(year) %>% 
  summarise(avg = mean(temperature,na.rm = TRUE)) %>% 
  mutate(time = paste0(year, "-01-01"),
         time = as.Date(time)) 

```

```{r baseline}
# mean temperature from 1961 to 1990, follow the baseline selected by the Australian BOM
meanTemp <- temperature %>% 
  filter(temp_type == "max") %>% 
  filter(year >= 1961 & year <= 1990) %>% 
  summarise(avg = mean(temperature, na.rm = TRUE))
```

```{r themes}
# combine themes
themes_p <- theme(axis.title.x=element_blank(),
                  axis.title.y=element_blank(),
                  axis.ticks=element_blank(),
                  axis.text.x = element_blank(),
                  axis.text.y = element_text(color = "grey", 
                                             face = "bold"),
                  plot.title = element_text(face = "bold"),
                  plot.background = element_rect(fill="white"),
                  panel.background = element_rect(fill="white"))
```

```{r temp-diff, message=FALSE,warning=FALSE, fig.cap="The plot for the difference between the average temperature of 1961-1990 (as baseline) and the annual average temperature for each year from 1910 to 2019, calculated by daily maximum temperature", warning=FALSE, message=FALSE}
# temperature difference data
temp_diff <- temperature %>%
  filter(temp_type == "max") %>% 
  filter(year <= 2019) %>% 
  group_by(year) %>% 
  summarise(avg = mean(temperature,na.rm = TRUE)) %>% 
  mutate(diff = (avg - meanTemp$avg),
         diff = round(diff,2))

temp_diff$ismax <- with(temp_diff, ave(diff, FUN=function(x) x==max(x)))

# plot difference
temp_diff %>% 
  ggplot(aes(year, diff, fill=as.factor(ismax))) + 
  geom_bar(stat="identity") +
  scale_y_continuous(breaks = seq(-1.5,1.5,0.5))+
  scale_fill_manual(breaks=c("0","1"), 
                    values=c("#C7C7C7","#F08080"), 
                    guide="none")+
  geom_hline(yintercept = 0, color = "#9C9C9C")+
  annotate(geom="text", 
           x=1930, y=0.8, 
           label="Annual temperature's difference \n with the 1961–1990 average",
           color="grey", 
           size = 3)+
  annotate(geom="text", 
           x=1917, y=1.5, 
           label="above than average(°C)",
           color="grey", 
           size = 3)+
  annotate(geom = "text",
           x=2019,y=1.8,
           label="2019",
           size = 3)+
  annotate(geom = "text",
           x=1917,y=-1.9,
           label="1917",
           size = 3)+
  annotate(geom = "text",
           x=1972,y=0.5,
           label="1970",
           size = 3)+
  ggtitle("The annual temperature difference in Australia from 1910 to 2019")+
  themes_p

```
Figure \@ref(fig:temp-diff) shows the average temperature difference in Australia from 1910 to 2019. It is compared against the average temperature from 1961-1990. There is a clear upward trend, thus indicating that the average temperature in Australia is increasing. The figure highlights the average temperature for 2019, as it was the highest average temperature on record. 
 
```{r baseline-rain, warning=FALSE, message=FALSE}
#the annual rainfall baseline selected by the Australian BOM from 1961 to 1990
rain<-rainfall%>%
 drop_na()%>%
  select(station_code,year,rainfall,city_name)%>%
  filter(station_code %in% c("9151","23001","40913","66062","70351","86232"))%>%
  filter(year>=1970&year<=2019)

rainmean<-rain%>%
  select(year,rainfall)%>%
  filter(year>=1970&year<=1990)%>%
  group_by(year)%>%
 summarise(avg=sum(rainfall))

rainmean<-rainmean%>%
  mutate(baseline=sum(avg)/120)
  
```

```{r rainfall-diff, warning=FALSE, message=FALSE}
#277.6 is the annual rainfall baseline selected by the Australian BOM from 1961 to 1990
rain_diff <- rain %>%
  select(year,rainfall)%>%
  group_by(year) %>% 
  summarise(avg = sum(rainfall)/6)%>%
  mutate(diff = (avg - rainmean$baseline ),
         diff = round(diff,2))
```

```{r rain-diff-annual,fig.cap="Annual rainfall difference 1961-1990 (as baseline) and the annual average rainfall for each year from 1910 to 2019, calculated by daily maximum rainfall"}
rain_diff$ismax <- with(rain_diff, ave(year, FUN=function(x) x==max(x)))

ggplot(rain_diff,aes(x=year, y=diff,fill=as.factor(ismax))) + 
  geom_bar(stat = "identity")+
  scale_fill_manual(breaks=c("0","1"), values=c("#C7C7C7","#F08080"), guide="none")+
   geom_hline(yintercept = 0, color = "#9C9C9C")+
  scale_y_continuous(breaks = seq(-400,400,100))+
  annotate(geom="text", 
           x=1985, y=230, 
           label="Annual rainfall difference \n with the 1961–1990 average",
           color="grey", 
           size = 3)+
  annotate(geom="text", 
           x=1975, y=300, 
           label="above than millimeters(mm)",
           color="grey", 
           size = 3)+
  annotate(geom = "text",
           x=2019,y=-300,
           label="2019",
           size = 3)+
  annotate(geom = "text",
           x=1994,y=-380,
           label="1994",
           size = 3)+
   annotate(geom = "text",
           x=2000,y=-220,
           label="2000",
           size = 3)+
  annotate(geom = "text",
           x=2010,y=100,
           label="2010",
           size = 3)+
  ylab("rainfall")+
  ggtitle("The annual rainfall difference in Australia from 1970 to 2019")+
  themes_p

```

Figure \@ref(fig:rain-diff-annual) shows the average rainfall difference in Australia from 1910 to 2019. The calculated average rainfall for a given year is compared against the average rainfall from 1961-1990. From 1961-1990 the average rainfall is variable, which is likely a result of the natural weather patterns. However, after 1990 there is a clear downward trend, indicating that each year there is less rainfall than the 1961-1990 average. Interestingly enough, 2019 had one of biggest differences and thus had considerably less rainfall than other years.  

Both figures indicate that climate change has lead to Australia becoming a hotter and drier continent. As mentioned above, this is the 'perfect storm' for bushfires. 

## Bushfires

### When are the fires burning? {#month}

```{r when,fig.cap="The number of Australian fires in 12 month between 2001 and 2020", warning=FALSE, message=FALSE}
data_fire_Year <- nasa_fire %>% 
  mutate(acq_date = as.POSIXct(acq_date)) %>% 
  mutate(Year =year(acq_date),Month = month(acq_date)) %>% 
  mutate(Year = factor(Year)) %>% 
  group_by(Year,Month)%>% 
  summarise(Total = n()) 

p1 <- data_fire_Year %>% 
  mutate( highlight=ifelse(Year=="2019", "2019", "Other")) %>% 
  ggplot( aes(x=Month, 
              y=Total, 
              group=Year, 
              color=highlight, 
              size=highlight)) +
  scale_x_continuous(breaks = seq(1, 12, by = 1))+
  geom_line()+
  geom_label( x=4.5, y=2000, 
              label="Other years,2001 to 2018", 
              size=2, 
              color="#69b3a2")+
  geom_label( x=11.5, y=90000, 
              label="2019", 
              size=3, 
              color="#69b3a2")+
  geom_label( x=8.5, 
              y=115000, 
              label="2011", 
              size=3, 
              color="#69b3a2")+
  scale_color_manual(values = c("#69b3a2", "grey")) +
    scale_size_manual(values=c(1.5,0.2)) +
    theme(legend.position="none") +
    ggtitle("The number of Australian bushfires in 12 month from 2001 to 2020") +
    theme(axis.text.y = element_text(color = "grey", 
                                             face = "bold"),
        plot.title = element_text(face = "bold"),
        plot.background = element_rect(fill="white"),
        panel.background = element_rect(fill="white"))
 
ggplotly(p1) 
```


Figure \@ref(fig:when) is a line plot showing the number of bushfires for each year, ordered according to month. The trend line for 2019 is clearly different to other years, which is due to the bushfires in Victoria and New South Wales. These were the biggest bushfires since the European Settlement [@nolan2020causes], hence the clear upward trend from September 2019. 

In addition, there were more bushfires in September 2011 than in any other year in the same period. According to @blanchi2014environmental, these bushfires were the result of a combination of low rainfall and strong winds. 
 
The overall trend line shows that bushfires are more likely to occur from August to November. This is the winter-spring period in Australia. These months are typically drier in most parts of Australia as seen in Figure \@ref(fig:rainjitterplot), which can lead to the ignition of forest fuels [@sullivan2012fuel] and thus bushfires.  

### Where are the bushfires burning?

```{r state,fig.cap=" The number of bushfire in different states or regions in the past 20 years", warning=FALSE, message=FALSE}
# divide regions
WA_fire <- nasa_fire %>% 
  filter(longitude < 128) %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "WA")

NT_fire <- nasa_fire %>% 
  filter(longitude < 138, latitude < '-25')  %>% 
  filter(128<longitude) %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "NT") 

SA_fire <- nasa_fire %>% 
  filter(longitude < 141, latitude > '-25')  %>% 
  filter(128<longitude) %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "SA") 

QLD_1 <- nasa_fire %>% 
  filter(longitude > 141, latitude < '-25')  %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "QLD") 

QLD_2  <- nasa_fire %>% 
  filter(longitude > 141, latitude < '-29')  %>% 
  filter(latitude >'-26') %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "QLD")


VIC_NSW  <- nasa_fire %>% 
  filter(longitude > 141, latitude > '-29')  %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "VIC_NSW") 

# make a plot for 6 regions
state_fire <- bind_rows(WA_fire,NT_fire,SA_fire,VIC_NSW ,QLD_1,QLD_2) %>% 
  group_by (state,Year) %>% 
  summarise(Total= n())
ggplot(state_fire,aes(x = Year,y = Total)) +
  geom_col(fill = "grey")+
  facet_wrap(~state)+
   theme(axis.text.y = element_text(color = "grey", 
         face = "bold"),
        plot.title = element_text(face = "bold"),
         plot.background = element_rect(fill="white"),
        panel.background = element_rect(fill="white"))+
  ggtitle("The number of bushfire in different states or regions in the past 20 year")

```
Most bushfires occur in the Northern Territory and Queensland, as seen in Figure \@ref(fig:state). This is likely to both areas being prone to drought and have high concentrations of vegetation. 

Figure \@ref(fig:state) shows that the number of fires in Victoria and New South Wales is relatively stable, with the exception of 2019. As mentioned above, this is due to the catastrophic bushfires that took place over this period. Additionally, figure \@ref(fig:map) shows the distribution of bushfires from the end of 2019 to the beginning of 2020. It predominantly captures Victoria and NSW, due to the extensive fires in 2019.

```{r map, message = FALSE, fig.cap="The distribution point for Australian bushfires from 2019-12-29 to 2020-01-05(the darker the color, the more serious the fire)", fig.align='center'}
subset <- nasa_fire %>% 
  filter(acq_date >= "2019-12-29" & acq_date <= "2020-01-05")

pal <- colorNumeric(palette = "YlOrRd", domain = subset$brightness)

leaflet(data = subset) %>%
    addTiles() %>%
    addCircleMarkers(lat = ~latitude, 
                     lng = ~longitude, 
                     popup = ~brightness, 
                     radius=2,
                     color = ~pal(brightness), 
                     stroke = FALSE, 
                     fillOpacity = 0.6) %>%
    addLegend(position = "bottomleft", pal = pal, values = ~brightness)

```

## How does temperature and rainfall affect the number of bushfires?

### Positive association with temperature and bushfires {#temp}

```{r geomline}
data_fire_Year_line <- nasa_fire %>% 
  mutate(acq_date = as.POSIXct(acq_date)) %>% 
  mutate(Year = year(acq_date), Month = month(acq_date)) %>% 
  filter(Year > 2000) %>% 
  mutate(Year = factor(Year)) %>%
  group_by(Year,Month)%>% 
  summarise(Total = n()) %>% 
  mutate(time = paste0(Year, "-", Month, "-01"),
         time = as.Date(time))


rain_agv_line <- rainfall %>% 
  filter(year > "2000") %>% 
  group_by (year, month) %>% 
  summarise(`Average rainfall`= mean(rainfall,na.rm=TRUE)) %>% 
  arrange(-year) %>% 
  mutate(time = paste0(year, "-", month, "-01"),
         time = as.Date(time))

temp_year_line <- temperature %>% 
  filter(temp_type == "max") %>% 
  filter(year > 2000) %>% 
  group_by(year) %>% 
  summarise(avg = mean(temperature,na.rm = TRUE)) %>% 
  mutate(time = paste0(year, "-01-01"),
         time = as.Date(time))


fire_rain <- data_fire_Year_line %>% 
  left_join(rain_agv_line, by = "time")

fire_temp <- data_fire_Year_line %>% 
  left_join(temp_year_line, by = "time") %>% 
  drop_na()
```



```{r, fig.cap="The Trend of Temperature and Bushfires"}
scl <- 1000
p4 <- ggplot(fire_temp, aes(x = time)) + 
  geom_line(aes(y = Total/scl, colour = "Total_Bushfires")) + 
  geom_line(aes(y = avg, colour = "Avg_Temperature")) +
  scale_y_continuous(sec.axis = sec_axis(~./scl, name = "Avg"))+ 
  ggtitle("The Trend of Temperature and Bushfires") +
  theme_bw() +
  theme(axis.text.y = element_text(color = "grey", face = "bold"),
  plot.title = element_text(face = "bold"),
  plot.background = element_rect(fill="white"))

ggplotly(p4)
```

Figure \@ref(fig:temp-yearly-plot) shows the average temperature in 2019 is significantly higher than other years. A strong positive Indian Ocean Dipole (IOD) phenomenon was the culprit[@harris2019understanding], and contributed to very high temperatures and low rainfall across Australia[@bureau2019annual], beginning in May 2019 and lasting until the end of the year.   

```{r IOD, fig.cap= 'Indian Ocean Dipole: positive phase. Source from Australian BOM.', out.width = '60%', out.height='60%'}
knitr::include_graphics("images/iod-positive.png")
```
  
How big is the difference between the temperature in 2019 and other years? 

Figure \@ref(fig:temp-diff) shows the average annual temperature from 1961 to 1990. From 1910 to mid-1950, the annual average temperature for almost all years was lower than the baseline. Since the mid-1950s, the average annual temperature has been higher than the baseline. Although there has been the odd year, these are outliers.

Moreover, it is worth noting that 2019 is significantly higher than in other years, with a difference of above 1.5°C. As @bureau2019annual states, 2019 was Australia's warmest year on record, surpassing the previous record of +1.35°C in 2013.   

Evidently, the rising annual temperature has been a warning that Global warming is a growing problem. Ultimately, global warming leads to many natural disasters, bushfires included. 

Figure \@ref(fig:fire-yearly-plot) shows the total number of fires in Australia from 2001 to 2019. Compared with Figure \@ref(fig:temp-yearly-plot), the total number of fires is fairly consistent??. When the temperature is high, there are generally more fires. 

The most fires occurred in 2012 with 474,964 fires, however, the average temperature was relatively low, at 22.57°C. These bushfires can be explained by a lightening strike[@dowdy2012characteristics]. 

Ultimately, the analysis above demonstrates that a high temperature is closely related to bushfires. When the temperature is high and climate is dry, forest fuels are more likely to catch alight[@oldenborgh2020attribution].  

### Negative association with rain and bushfires {#rain}

```{r, fig.cap="The Trend of Rainfall and Bushfires"}
scl2 <-10000
p5 <- ggplot(fire_rain, aes(x = time)) + 
  geom_line(aes(y = Total/scl2, colour = "Total")) + 
  geom_line(aes(y = `Average rainfall`, colour = "Avg")) +
  scale_y_continuous(sec.axis = sec_axis(~./scl2, name = "Avg Rainfall"))
  ggtitle("The Trend of Rainfall and Bushfires") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold"), plot.background = element_rect(fill="white"))

ggplotly(p5)
```

Australia's location means that rainfall is highly variable. It is strongly influenced by the global climate system phenomena such as El Niño, La Niña, and IOD. 

Figure \@ref(fig:rain-yearly-plot) shows how the annual rainfall has changed over time in Australia. In 1994 there was a severe drought, influenced by the El Niño weather pattern. This was the fifth year of drought for some parts of Australia[@nicholls2004changing]. In 2010, the annual rainfall was the highest in 20 years. This was a result of a La Niña event. 

2019 was the driest year in the last 20 years. One reason is that the strongest positive IOD reached the highest values on record across 60 years, and due to the frequency and influence of sea-surface temperature changes, the El Nino-Southern Oscillation(ENSO) is neutral throughout the year??????

As a result of the positive IOD, the Walker Circulation was severely curtailed and there was abnormal easterly winds in the Indian Ocean. These winds meant cloud cover in Australia was swept away, dramatically reducing rainfall across Australia[@hughes2003climate]. 

Figure \@ref(fig:fire-yearly-plot) shows there has been a consistent average number of fires (250,000) in the last 20 years. The number of fires in 2010 was the lowest, which may be due to the high rainfall as a result of the La Niña event. 
  
From Figure \@ref(fig:rain-diff-annual), the annual average rainfall changed cross-time compare with the average baseline. Over the last 20 years, the rainfall has consistently been below average, with the occasional outlier in 2010 and 2011.


It is evident that the low rainfall in 2019 was a contributor to the high number of bushfires.

### The correlation between climatic conditions and bushfires

```{r rainfall-annual-data, warning=FALSE, message=FALSE}
rain_annual<-rain%>%
  drop_na()%>%
  filter(year>=2001&year<=2019) %>% 
  group_by(year) %>% 
  summarise(rainfall = sum(rainfall))%>%
  mutate(year=as.character(year))

```

```{r fire-annual-total, warning=FALSE, message=FALSE}
fire_annual <- nasa_fire %>% 
  filter(acq_date >= "2001-01-01" & acq_date <= "2019-12-31") %>% 
  mutate(acq_date = as.POSIXct(acq_date)) %>% 
  mutate(year =year(acq_date),
         Month = month(acq_date),
         Day=day(acq_date)) %>% 
  mutate(year = as.character(year)) %>% 
  group_by(year)%>% 
  summarise(fire = n()) 
```

```{r temp-annual-data}
temp_annual <- temp_year %>%
  filter(year>=2001&year <= 2019) %>% 
  mutate(year=as.character(year)) %>% 
  select(-time,
         temperature = avg)
```


```{r all-data}
all_data <- fire_annual %>% 
  left_join(rain_annual, by = "year") %>% 
  left_join(temp_annual, by = "year") %>%
  mutate(log_fire = log1p(fire),
         log_rainfall=log(rainfall))
```

```{r correlation_color, fig.cap="The correlation between rainfall, temperature and bushfires"}

all_data1 <- all_data %>%
  select(-year,
         -fire,
         -rainfall)
Cor <- cor(all_data1)
corrplot(Cor, method = 'color', 
                     order = 'hclust', 
                     type = 'upper', 
                     diag = FALSE, 
                     tl.col = 'black',
                     addCoef.col = "grey30",
                     number.cex = 1.2,
                     col = colorRampPalette(colors = c('red', 'white', 'blue'))(200),
                     main = 'Weather and Bushfires Correlation',
                     mar = c(1,1,1,1),
                     family = 'Avenir')

```


Figure \@ref(fig:correlation-color) demonstrated that rainfall and bushfires have a negative correlation, suggesting that more rainfall means fewer bushfires. Additionally, it shows that a higher temperature leads to more bushfires. Although the correlation between these two variables is small, the relationship is still evident. Moreover, when the temperature is higher, there is less rain.
  
In conclusion, the main climatic conditions of bushfire is hot and dry[@van2020attribution]. The graph of annual rainfall and temperature show that the hottest and driest year is 2019, which has the most massive bushfires in Australia as well. Therefore, as the combination of arid and severe hot conditions adds up to more powerful fires, indicating that declines in rainfall and increases in temperature have likely been a primary driver of increases in wildfire area burned.  

# Conclusions {#conclusion}

This analysis has looked at when, where and what climactic condition bushfires are likely to thrive in. Bushfires are common from August to November, and are frequently found in the Northern Territory and Western Australia. High temperature and drought are the two biggest contributors to bushfires[@van2020attribution]. This is consistent with data from 2019, which discovered that it was the hottest and driest year on record with the highest number of bushfires.      

# Acknowlegments{-}

The authors would like to thank all the contributors to the following R package: @tidyverse,  @ggplot2, @readr, @leaflet, @xts, @here, @base, @ggthemes, @dplyr, @dygraphs, @lulbridate, @ggally, @hrbrthemes.

# References

# Year section








From Figure \@ref(fig:correlation_color), it seems that the rainfall and bushfires have small negative correlation, which is only 30%. This means that if the average annual precipitation increases, the probability of bushfires may decrease with 30% of the increase in precipitation. 

As for temperature and bushfires, the correlation between these two variables is only 0.13 which is too close to 0. Therefore, Our group believes that there is no correlation between temperature and occurrence of bushfires in the past 20 years. More data may be needed later to draw the different conclusion.

Finally, let's observe the precipitation and temperature. The correlation between them is -0.47, which is the largest absolute value among the three correlations, which indicates that their correlation degree is the highest. The correlation coefficient of 0.47 means that if the temperature rises, the precipitation will decrease to 47% of the range that rise. In my opinion, this is because temperatures will impact the rate of evaluation, with higher temperatures leading to drier weather and faster air moisture loss. [@hausfather2018explainer].  
  
In conclusion, from corrplot it is clear that the main climatic conditions to affect bushfires is the decreasing of the rainfall. What surprided our group was that the direct effect of temperature rise on Australian bushfires occurrence was almost 0. However, due to the temperature will affect the precipitation and thus the occurrence of bushfires, so people should pay attention to the greenhouse effect and other issues. The upper graphs show that 2019 is the hot and drive year in Australia, which also has the most massive bushfires occurred. That discovery confirms the accuracy of our corrplot again. The increase of temperature leads to the decrease of rainfall have been a primary driver of increases in bushfires area of Australia.

[@van2020attribution]


>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

## VEGA"S PART (ADDITIONAL TO MASTER)

## Bushfires

The Australian climate is generally hot and dry, bushfires can occur at anytime of the year for the most of regions[@bushfire]. However, are there more bushfires prefer happened in the summer or winter? 

<!-- Did bushfires more likely to occur in Northern Territory(NT)?  KEEP IT AT THE LAST FOR SURPRISE -->

In this section, we will discuss it by analyzing the bushfire data for the past 20 years. 

### In which months are bushfires burning? {#month}

```{r when,fig.cap="Yearly Australian fires from 2001 until 2020", warning=FALSE, message=FALSE}

m <- factor(c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))

data_fire_Year <- nasa_fire %>% 
  mutate(acq_date = as.POSIXct(acq_date)) %>% 
  mutate(Year =year(acq_date),Month = month(acq_date)) %>% 
  mutate(Year = factor(Year)) %>% 
  mutate(Month = case_when(Month == "1" ~ "Jan",
                           Month == "2" ~ "Feb",
                           Month == "3" ~ "Mar",
                           Month == "4" ~ "Apr",
                           Month == "5" ~ "May",
                           Month == "6" ~ "Jun",
                           Month == "7" ~ "Jul",
                           Month == "8" ~ "Aug",
                           Month == "9" ~ "Sep",
                           Month == "10" ~ "Oct",
                           Month == "11" ~ "Nov",
                           Month == "12" ~ "Dec",
                                                     )) %>% 
  mutate(Month = factor(Month, levels = m)) %>% 
  group_by(Year,Month)%>% 
  summarise(Total = n()) 



# m <- factor(c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"), levels = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))

p1 <- data_fire_Year %>% 
  mutate( highlight=ifelse(Year=="2019", "2019", "Other")) %>% 
  ggplot( aes(x=Month, 
              y=Total, 
              group=Year, 
              color=highlight, 
              size=highlight)) +
  # scale_x_continuous(breaks = seq(1, 12, by = 1))+
  geom_line()+
  # geom_label( x=4.5, y=2000, 
  #             label="Other years,2001 to 2018", 
  #             size=2, 
  #             color="#69b3a2")+
  # geom_label( x=11.5, y=90000, 
  #             label="2019", 
  #             size=3, 
  #             color="#69b3a2")+
  # geom_label( x=8.5, 
  #             y=115000, 
  #             label="2011", 
  #             size=3, 
  #             color="#69b3a2")+
  scale_color_manual(values = c("red", "grey")) +
    scale_size_manual(values=c(1.5,0.2)) +
    theme(legend.position="none") +
    ggtitle("Yearly Australian fires from 2001 until 2020") +
    theme(axis.text.y = element_text(color = "grey", 
                                             face = "bold"),
        plot.title = element_text(face = "bold"),
        plot.background = element_rect(fill="white"),
        panel.background = element_rect(fill="white"))
 
ggplotly(p1) 
```

From Figure \@ref(fig:when), there are some unusual phenomena. 
Firstly, we can see that the bushfires trend line in 2019 is quite different from other years. 

>> When the trend in other years (i.e. 2011 and 2012) seems to reach a peak in August and October respectively, the trend of bushfire in 2019 is still growing until December 2019. Unfortunately, we do not have additional data to see the continuity of the 2019 trend line in 2020. 
<!-- the main reason for that is the occurrence of extensive bushfires in Australia for 2019.  -->

<!-- And the bushfires from September 2019 is the most massive bushfire since European settlement[@nolan2020causes].  -->

>> According to the figure, the most severe bushfire occurs in 2011 with the number of spots reach 120.348 fire spots. We will look further into 2011 in the figure below.

<!-- Moreover, there was a significant increase in the number of bushfires in September 2011, far more than in any other year in the same period.  -->

<!-- <!-- As @blanchi2014environmental states, the combination of low rainfalls and strong winds led to the outbreak of bushfires in 2011.   --> -->

```{r average-rain, fig.cap ="Average monthly rainfall from 2001", warning=FALSE, message=FALSE}
rain_agv <- rainfall %>% 
  filter(year == "2011") %>% 
  mutate(month = case_when(month == "1" ~ "Jan",
                           month == "2" ~ "Feb",
                           month == "3" ~ "Mar",
                           month == "4" ~ "Apr",
                           month == "5" ~ "May",
                           month == "6" ~ "Jun",
                           month == "7" ~ "Jul",
                           month == "8" ~ "Aug",
                           month == "9" ~ "Sep",
                           month == "10" ~ "Oct",
                           month == "11" ~ "Nov",
                           month == "12" ~ "Dec",
                                                     )) %>% 
  group_by (month, city_name) %>% 
  summarise(`Average rainfall`= mean(rainfall,na.rm=TRUE)) %>% 
  arrange(`Average rainfall`)
 
m <- factor(c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))
 
r_agv <- rain_agv %>%
  mutate(month) %>%
  ggplot(aes(x= factor(month, m), y=`Average rainfall`/100) ) +
    # geom_segment(aes(x=month ,xend= month, y=0, yend=`Average rainfall`), color="grey") +
    geom_point(size=3, color="#69b3a2") +
    # theme_ipsum() +
    theme_bw()+
    xlab("")+
  ylab("")+
    ggtitle("Average Monthly Rainfall (in Mm) in 2011") +
    facet_wrap(~city_name, nrow = 3) 

ggplotly(r_agv)
```

As can be seen from figure \@ref(fig:average-rain), in 2011 (which is the worst year) 

Also, it's interesting to find that bushfires are more likely to occur in May, and month from August to November, especially October. However, August to October is the winter to spring period in Australia. It seems that the frequent occurrence of bushfires during this period mainly due to dryness, which makes forest fuels more likely to catch fire[@sullivan2012fuel]. Moreover, comparing with Figure \@ref(fig:average-rain), it can be easy to find that the driest months are September, October and May, which coincided with the peak of the bushfires.   

### Where are the bushfires burning?

In this part, we will focus on the relationship between bushfires and geographic locations. 
Firstly, we divided bushfire data into different states or regions according to the latitude and longitude, because the data downloaded from NASA does not contain information for states or regions. Since the borders of NSW and Victoria are not easily distinguished, so we finally putting them together as one region.  

```{r state,fig.cap=" The number of bushfire in different states or regions in the past 20 years", warning=FALSE, message=FALSE}
# divide regions
WA_fire <- nasa_fire %>% 
  filter(longitude < 128) %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "WA")

NT_fire <- nasa_fire %>% 
  filter(longitude < 138, latitude < '-25')  %>% 
  filter(128<longitude) %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "NT") 

SA_fire <- nasa_fire %>% 
  filter(longitude < 141, latitude > '-25')  %>% 
  filter(128<longitude) %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "SA") 

QLD_1 <- nasa_fire %>% 
  filter(longitude > 141, latitude < '-25')  %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "QLD") 

QLD_2  <- nasa_fire %>% 
  filter(longitude > 141, latitude < '-29')  %>% 
  filter(latitude >'-26') %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "QLD")


VIC_NSW  <- nasa_fire %>% 
  filter(longitude > 141, latitude > '-29')  %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "VIC_NSW") 

# make a plot for 6 regions
state_fire <- bind_rows(WA_fire,NT_fire,SA_fire,VIC_NSW ,QLD_1,QLD_2) %>% 
  group_by (state,Year) %>% 
  summarise(Total= n())

national_avg <- sum(state_fire$Total)/nrow(state_fire)

fire <- ggplot(state_fire, aes(x = Year,y = Total)) +
  geom_col(fill = ifelse(state_fire$Year %in% c("2011", "2019"), "red", "grey"))+
  facet_wrap(~state)+
   theme(axis.text.y = element_text(color = "grey", 
         face = "bold"),
        plot.title = element_text(face = "bold"),
         plot.background = element_rect(fill="white"),
        panel.background = element_rect(fill="white"))+
  geom_hline(yintercept = national_avg, linetype = "dashed", alpha = 0.5)+
  ggtitle("Bushfire in States/Regions during 20 years")

  ggplotly(fire)

```

Furthermore, we also draw a line that shows national average number of bushfires during 20 years period. Hence, we can see which states/territories that have more bushfires compared to national average. In addition, we are interested to see particular year of 2011 (the worst year) and 2019 (the different pattern).

Figure \@ref(fig:state) shows us that, in general, bushfires are mostly occured in the Northern Territory(NT) and West Australia (WA), possibly because both areas are more likely prone to drought (we will check this assumption in the following section) and comprises of large forests area according to Australia's Department of Agriculture. 

In 2011, NT has very high number of bushfires compared to other states. However, latest massive bushfires in 2019 is mostly occured in area comprises of Victoria and New South Wales. Figure \@ref(fig:map) shows fire spots from the latest bushfires (December 2019 to early January 2020), and we can find that it is mainly concentrated in Victoria and NSW.  

Based on the analysis, we will look at the causes of bushfires in Australia. Are there association between climate conditions to the bushfire? We will explore the story of climate conditions (temperature and rainfall level) in section \@ref(temp) and \@ref(rain).


```{r map, message = FALSE, fig.cap="The Fire Spots during 2019-12-29 until 2020-01-05(the darker the color, the more serious the fire)", fig.align='center'}
subset <- nasa_fire %>% 
  filter(acq_date >= "2019-12-29" & acq_date <= "2020-01-05")

pal <- colorNumeric(palette = "YlOrRd", domain = subset$brightness)

leaflet(data = subset) %>%
    addTiles() %>%
    addCircleMarkers(lat = ~latitude, 
                     lng = ~longitude, 
                     popup = ~brightness, 
                     radius=2,
                     color = ~pal(brightness), 
                     stroke = FALSE, 
                     fillOpacity = 0.6) %>%
    addLegend(position = "bottomleft", pal = pal, values = ~brightness)

```

## How does temperature and rainfall affect the number of bushfires?

### Positive association with temperature and bushfires {#temp}

This section will be focus on finding clues to answer research question of whether higher temperature contributes to higher frequency of bushfires occurences. Our base assumption is that these two variables have a positive association which means that if the temperature increase the number of fire spots should also increase and vice versa.    

```{r temp}
temperature <- temperature %>% 
  mutate(year = year(date)) 
```

```{r temp-yearly, warning=FALSE, message=FALSE}
# calculate annual mean temperature
temp_year <- temperature %>% 
  filter(temp_type == "max") %>% 
  filter(year <= 2019) %>% 
  group_by(year) %>% 
  summarise(avg = mean(temperature,na.rm = TRUE)) %>% 
  mutate(time = paste0(year, "-01-01"),
         time = as.Date(time)) 
```

```{r temp-yearly-plot,message=FALSE, warning=FALSE, fig.cap="Annual average temperature trends from 1910 to 2019, calculated by daily maximum temperature", fig.align='center'}
# prepare time series data
temp_year_dat <- xts(x = temp_year$avg, order.by = temp_year$time)

# # time series plot
# dygraph(temp_year_dat) %>%
#   dyOptions(labelsUTC = TRUE, 
#             fillGraph=TRUE, 
#             fillAlpha=0.15, 
#             drawGrid = FALSE, 
#             colors="#EED5D2") %>%
#   dyRangeSelector(dateWindow = c("2000-01-01", "2019-01-01"),
#                   height = 50,
#                   fillColor = "#BFEFFF",) %>%
#   dyCrosshair(direction = "vertical") %>%
#   dyHighlight(highlightCircleSize = 5, 
#               highlightSeriesBackgroundAlpha = 0.1, 
#               hideOnMouseOut = FALSE)  %>%
#   dyRoller(rollPeriod = 1) %>% 
#   dySeries("V1", label = "Average temperature(°C)")

```


<!-- Since the 1970s, the rising average annual temperature has been a warning that Global warming is a growing problem. Moreover, Global warming brings many catastrophic disasters, among which bushfires are one of them. Also, the average temperature in Australia has risen by 1°C since the industrial period, which is one of the reasons why bushfires were so frequently occurred in Australia and raged in 2019[@council2019not].    -->

In order to see the association between temperature and bushfire, we will produce a plot that compares these two variables side by side. To make a more visible pattern, temperature variable will be plotted as a temperature difference from the average temperature during period of observations (2000 - 2020). Mathematically, the temperature difference is formulated as below:

$$ Average\;Temperature\;Difference_n = Annual\;Temperature_n\; - Average\;Temperature\;in\;Period\;of\;Observations$$

```{r baseline}
# mean temperature from 1961 to 1990, follow the baseline selected by the Australian BOM
meanTemp <- temperature %>% 
  filter(temp_type == "max") %>% 
  filter(year >= 1961 & year <= 1990) %>% 
  summarise(avg = mean(temperature, na.rm = TRUE))
```

```{r themes}
# combine themes
themes_p <- theme(axis.title.x=element_blank(),
                  axis.title.y=element_blank(),
                  axis.ticks=element_blank(),
                  axis.text.x = element_blank(),
                  axis.text.y = element_text(color = "grey", 
                                             face = "bold"),
                  plot.title = element_text(face = "bold"),
                  plot.background = element_rect(fill="white"),
                  panel.background = element_rect(fill="white"))
```

```{r fire-year-sum, warning=FALSE, message=FALSE}
# calculate annual mean temperature
nasa_fire.month <- nasa_fire %>% 
  mutate(month = month(acq_date), year = year(acq_date)) %>% 
  group_by(year, month) %>% 
  summarise(n = n())

# Rescale avg_rain to create log10 and sqrt average fire to compare with annual temperature
avg_fire <- nasa_fire.month %>% 
  group_by(year) %>% 
  summarise(avg = mean(n)) %>% 
  mutate(log_sqrt_avg = log10(sqrt(avg)))

sum_fire <- nasa_fire %>% 
  mutate(year = year(acq_date)) %>% 
  filter(year > 2000 & year <= 2019) %>% 
  group_by(year) %>% 
  summarise(n = n()) %>% 
  mutate(time = paste0(year, "-01-01"),
         time = as.Date(time)) 
```

```{r temp-diff, message=FALSE,warning=FALSE, fig.cap="The Average Temperature Difference and Average Bushfires during 2000 until 2020", warning=FALSE, message=FALSE, out.width="70%"}
# temperature difference data
# temp_diff <- temperature %>%
#   filter(temp_type == "max") %>% 
#   filter(year <= 2019 & year >= 2000) %>% 
#   group_by(year) %>% 
#   summarise(avg = mean(temperature,na.rm = TRUE)) %>% 
#   mutate(diff = (avg - meanTemp$avg),
#          diff = round(diff,2))
# 
# temp_diff$ismax <- with(temp_diff, ave(diff, FUN=function(x) x==max(x)))
# 
# # plot difference
# temp_diff %>% 
#   filter(year >= 2000) %>% 
#   ggplot(aes(year, diff, fill=as.factor(ismax))) + 
#   geom_bar(stat="identity") +
#   scale_y_continuous(breaks = seq(-1.5,1.5,0.5))+
#   scale_fill_manual(breaks=c("0","1"), 
#                     values=c("#C7C7C7","#F08080"), 
#                     guide="none")+
#   geom_hline(yintercept = 0, color = "#9C9C9C")+
#   annotate(geom="text", 
#            x=1930, y=0.8, 
#            label="Annual temperature's difference \n with the 1961–1990 average",
#            color="grey", 
#            size = 3)+
#   annotate(geom="text", 
#            x=1917, y=1.5, 
#            label="above than average(°C)",
#            color="grey", 
#            size = 3)+
#   annotate(geom = "text",
#            x=2019,y=1.8,
#            label="2019",
#            size = 3)+
#   annotate(geom = "text",
#            x=1917,y=-1.9,
#            label="1917",
#            size = 3)+
#   annotate(geom = "text",
#            x=1972,y=0.5,
#            label="1970",
#            size = 3)+
#   ggtitle("The annual temperature difference in Australia from 1910 to 2019")+
#   themes_p

mean_fire <- mean(sum_fire$n)

bushfire_avg <- sum_fire %>% 
  mutate(avg_fire = as.numeric(lapply(mean_fire, rep))) %>% 
  mutate(diff_fire = avg_fire - n,
         diff_fire = round(diff_fire,2))

# Temp diffences from 2000-2020
temp_diff <- temperature %>%
  filter(temp_type == "max") %>% 
  filter(year <= 2019 & year >= 2000) %>% 
  group_by(year) %>% 
  summarise(avg = mean(temperature,na.rm = TRUE)) %>% 
  mutate(diff = (avg - meanTemp$avg),
         diff = round(diff,2))

temp_diff$ismax <- with(temp_diff, ave(diff, FUN=function(x) x==max(x)))

# join temp with fire
temp_fire <- left_join(temp_diff, avg_fire, by = "year")

# plot difference
temp_vs_fire <- temp_fire %>% 
  filter(year >= 2000) %>% 
  ggplot(aes(x = year)) + 
  geom_bar(aes(y = diff), stat="identity", alpha = 0.4) +
  geom_line(aes(y = diff), color = "blue", size = 1.1)+
  geom_text(aes(y = log_sqrt_avg, label = ifelse(year == 2012, "Average BushFires (scaled down)", "")), cex = 3, nudge_x = -1, nudge_y = 0.25,)+ 
  geom_line(aes(y = log_sqrt_avg), color = "red", size = 1.1)+
  scale_y_continuous(breaks = seq(-1.5,1.5,0.5))+
  scale_fill_manual(breaks=c("0","1"), 
                    values=c("#C7C7C7","#F08080"), 
                    guide="none")+
  geom_hline(yintercept = 0, color = "#9C9C9C")+
  geom_vline(xintercept = 2011, linetype = "dashed", alpha = 0.5)+
  geom_vline(xintercept = 2019, linetype = "dashed", alpha = 0.5)+
  ylab("Temperature Differences (celcius)")+
  ggtitle("Average Temperature Difference vs Bushfires")

ggplotly(temp_vs_fire)

```

On the other hand, since the average number of bushfires (fire spots) has different scale with the temperature, we will scale down the annual average bushfires using log 10 and square root. By doing so, we can put the two variables in a single plot to see the patterns of each variables. 

As we can see from figure \@ref(fig:temp-diff), the annual temperature trend seems to rise since 2000 until 2019. Likewise, the annual bushfires also slighlty increase during observed years. **Therefore, we can see a positive association between these two variables, although, the association seems not really strong**. 

As an example, we can see that in 2011 the average bushfires rise sharply (marked by black dashed line) while the temperature only a bit increase from 2010. Another example of the weak association is also shown in the trends during 2015 until 2020. In that period, average bushfires seems to slighlty increase whereas the temperature actually rises significantly. Further analysis on correlation between temperature and bushfires will be discussed in the last section of this paper.    


### Negative association with rain and bushfires {#rain}

Has the less rainfall affected the more bushfires in Australia? Or has the more rainfall influenced the less bushfires?   Because of the location of Australia, the rainfall in Australia is highly variable, which is strongly influenced by global climate system phenomena such as El Niño, La Niña, and IOD. Despite this large natural variability, the potential long-term trends are evident in some regions, even effecting the local rainfall.   
In this section, we will explore the relationship between rainfall and bushfires, is it positive or negative?   
  
As a first step, we observe annual rainfall level that retrieved from the rainfall dataset. The interval of observation is ranging from 2000 until 2020.

```{r rainfall-wrangling-data}
rain<-rainfall%>%
 drop_na()%>%
  select(station_code,year,rainfall,city_name)%>%
  filter(station_code %in% c("9151","23001","40913","66062","70351","86232"))%>%
  filter(year>=1970&year<=2019)
```

```{r rain-year-sum, warning=FALSE, message=FALSE}
# calculate annual rainfall
annual_rain <- rain %>% 
  select(year,rainfall)%>%
  group_by(year) %>% 
  summarise(total=sum(rainfall))%>%
    mutate(time = paste0(year, "-01-01"),
         time = as.Date(time)) 
```



```{r baseline-rain, warning=FALSE, message=FALSE}
#the annual rainfall baseline selected by the Australian BOM from 1961 to 1990
rainmean<-rain%>%
  select(year,rainfall)%>%
  filter(year>=1970 & year<=1990)%>%
  group_by(year)%>%
 summarise(avg = mean(rainfall))

rainmean <- rainmean%>%
  mutate(baseline= mean(avg))
  
```

```{r rainfall-diff, warning=FALSE, message=FALSE}
#277.6 is the annual rainfall baseline selected by the Australian BOM from 1961 to 1990
rain_diff <- rain %>%
  select(year,rainfall)%>%
  filter(year >= 2000) %>% 
  group_by(year) %>% 
  summarise(avg = mean(rainfall))%>%
  mutate(baseline = as.numeric(lapply(rainmean$baseline[1], rep))) %>% 
  mutate(diff = avg - baseline,
         diff = round(diff,2))
```

```{r rain-annual,fig.cap="Annual Rainfall and Bushfires", out.width="70%"}
rain_diff$ismax <- with(rain_diff, ave(year, FUN=function(x) x==max(x)))

rain_vs_fire <- left_join(rain_diff, avg_fire, by = "year") %>% 
  mutate(log_avg = log10(avg.y)+4)

rainfire <- ggplot(rain_vs_fire, aes(x = year)) + 
  geom_bar(aes(y = avg.x), stat = "identity", alpha = 0.4) +
  # scale_fill_manual(breaks=c("0","1"), values=c("#C7C7C7","#F08080"), guide="none")+
   geom_hline(yintercept = 0, color = "#9C9C9C")+
  # scale_y_continuous(breaks = seq(-400,400,100))+
  geom_line(aes(y = avg.x), color = "green", size = 1.1)+
  geom_text(aes(y = log_avg, label = ifelse(year == 2012, "Monthly Average BushFires (scaled down)", "")), cex = 3, nudge_y = 0.25)+ 
  geom_line(aes(y = log_avg), color = "red", size = 1.1)+
  ylab("Rainfall (mm)")+
  geom_vline(xintercept = 2011, linetype = "dashed")+
  geom_vline(xintercept = 2019, linetype = "dashed")+
  ggtitle("The Average Rainfall vs Bushfire")


ggplotly(rainfire)
```

Similarly with our previous job when comparing the trend of average temperature to bushfires, we will rescale down the annual average fire spots using log 10 in order to put its trend side by side with average rainfall trend in the same plot. 

As shown in figure \@ref(fig:rain-annual), we can see that, in general, annual rainfall has a **decreasing trend** during the observed period (2000 - 2020), while bushfires has a slightly **rising trend**. Hence, we can assume that rainfall and bushfires are negatively associated. This contrast pattern is quite obvious particularly in 2011 where average fire spots soar as the average rainfall level drops from 4.9 mm in 2010 to 4.15 mm in 2011. After 2015, bushfires is slightly increasing until 2019 as rainfall level continues to drop to its lowest level (2.16 mm) in the same year. 

To complete this analysis, we will check the exact coefficient number of correlation between variable rainfall and bushfires in the following section.  




























