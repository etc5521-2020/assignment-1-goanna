---
title: "ETC5521 Assignment 1"
subtitle: "Your title"
team: goanna
author:
  - XUE WANG
  - XITONG HE
  - CUIPING WEI
bibliography: references.bib
biblio-style: authoryear-comp
link-citations: yes
linestretch: 2
date: "`r Sys.Date()`"
output: 
  bookdown::html_document2: 
  theme: paper
  citation_package: biblatex
---
[This assignment is for ETC5521 Assignment 1 by Team `r rmarkdown::metadata$team` comprising of `r knitr::combine_words(rmarkdown::metadata$author)`.]{style="color:#006DAE;"}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, messages=FALSE, warning=FALSE, fig.pos = 'H', fig.align ='center')
```

```{r load-libraries, message=FALSE}
library(readr)
library(tidyverse)
library(kableExtra)
library(mapview)
library(here)
library(viridis)
library(leaflet)
library(knitr)
library(lubridate)
library(maps)
library(lubridate)
library(plotly)
<<<<<<< HEAD
library(rgdal)
library(hrbrthemes)
=======
library(xts)
library(dygraphs)
library(dplyr)
library(leaflet)
>>>>>>> 297d881f766388a62493cec0de018e87a4e41f2c
```


# Introduction and motivation

Bushfires that raged in Australia from September 2019 to early 2020 captured the attention of people around the world, especially the out-of-control bushfires in New South Wales in late December 2019 and early 2020. What caused the bushfires that lasted for four months? Is it closely related to global climate change?   
The report focuses on the relationship between temperature change, rainfall change and day-night factors on bushfires.  


# Data description

This section mainly introduces the data, data sources and data description.  
There are three data sets used on this analysis, and the cleaned data is obtained from [GitHub tidytuesday](https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-01-07/readme.md).  

```{r tem-function}
# clean temperature
# expand the time range of temperature

name_df <- tribble(
  ~station_code, ~city_name, ~site_name,
  "9021", "PERTH", "PERTH AIRPORT",
  "18192", "PORT", "PORT LINCOLN AWS",
  "23090", "KENT", "KENT TOWN",
  "40842", "BRISBANE", "BRISBANE AERO",
  "66062", "SYDNEY", "SYDNEY (OBSERVATORY HILL)",
  "70351", "CANBERRA", "CANBERRA AIRPORT",
  "86338", "MELBOURNE", "MELBOURNE (OLYMPIC PARK)"
)

read_temp_list <- list.files(here::here("data", "2020-01-07")) %>% 
  .[str_detect(., "IDCJAC0010|IDCJAC0011")]

read_clean_temp_data <- function(file_name){
  
  temp_descrip <- if_else(str_detect(file_name, "IDCJAC0010"), "max", "min")
  
  read_csv(here::here("data", "2020-01-07", file_name)) %>% 
    janitor::clean_names() %>% 
    rename(station_code = bureau_of_meteorology_station_number,
           temperature = contains("degree")) %>% 
    mutate(temp_type = temp_descrip,
           date = paste0(year,"-",month,"-",day),
           station_code = as.character(station_code)) %>% 
    left_join(name_df, by = "station_code") %>% 
    select(city_name, date, temperature, temp_type, site_name) 
  
}
```


```{r tem-expand, message=FALSE}
# map raw data
clean_temp_df <- read_temp_list %>% 
  purrr::map(read_clean_temp_data) %>% 
  bind_rows() %>% 
  mutate(date = as.Date(date, "%Y-%m-%d"))%>% 
  filter(date > "2019-05-31" & date <= "2020-01-05") 
```

```{r rain-b-function}
# expand the time range of rainfall for Brisbane
name_df_b <- tribble(
  ~station_code, ~city_name, ~lat, ~long, ~station_name,
  "40140", "Brisbane", -27.48, 153.04, "Brisbane",
)

read_precip_list <- list.files(here::here("data", "2020-01-07")) %>% 
  .[str_detect(., "IDCJAC0009")]

read_clean_precip_data_b <- function(file_name){
  
  read_csv(here::here("data", "2020-01-07", file_name)) %>% 
    janitor::clean_names() %>% 
    select("station_code" = bureau_of_meteorology_station_number,
           year, month, day,
           "rainfall"= rainfall_amount_millimetres, 
           "period" = period_over_which_rainfall_was_measured_days,
           quality) %>% 
    mutate(station_code = as.character(station_code),
           date = paste0(year,"-",month,"-",day)) %>% 
    left_join(name_df_b, by = "station_code") %>% 
    select(station_code, city_name, everything())
}
```


```{r rain-c-function}
# expand the time range of rainfall for Canberra
name_df_c <- tribble(
  ~station_code, ~city_name, ~lat, ~long, ~station_name,
  "70246", "Canberra", -35.31, 149.2, "Canberra Airport"
)

read_precip_list <- list.files(here::here("data", "2020-01-07")) %>% 
  .[str_detect(., "IDCJAC0009")]

read_clean_precip_data_c <- function(file_name){
  
  read_csv(here::here("data", "2020-01-07", file_name)) %>% 
    janitor::clean_names() %>% 
    select("station_code" = bureau_of_meteorology_station_number,
           year, month, day,
           "rainfall"= rainfall_amount_millimetres, 
           "period" = period_over_which_rainfall_was_measured_days,
           quality) %>% 
    mutate(station_code = as.character(station_code),
           date = paste0(year,"-",month,"-",day)) %>% 
    left_join(name_df_c, by = "station_code") %>% 
    select(station_code, city_name, everything())
}
```

```{r rain-expand-canberra, message=FALSE}
# select the time range with Canberra data
clean_rain_df_canberra <- read_precip_list %>% 
  purrr::map(read_clean_precip_data_c) %>% 
  bind_rows()%>%
  mutate(date = as.Date(date, "%Y-%m-%d"))%>%
  filter(date <= "2008-09-18") %>%
  mutate(station_code=recode(station_code,
                             "70246"= "070351"))%>%
  select(-date)

```

```{r rain-expand-brisbane, message=FALSE}
# select the time range with brisbane data
clean_rain_df_brisbane <- read_precip_list %>% 
  purrr::map(read_clean_precip_data_b) %>% 
  bind_rows()%>%
  mutate(date = as.Date(date, "%Y-%m-%d"))%>%
  filter(date <= "1999-12-10")%>%
  mutate(station_code=recode(station_code,
                             "40140"="040913"))%>%
  select(-date)

```

```{r read-data, message=FALSE, warning=FALSE}
# Get the cleaned data from Github
# the time range for old temperature data is from 1910-01-01 to 2019-05-31
rainfall_old <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-07/rainfall.csv')
temperature_old <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-07/temperature.csv')

# the time range for old fires data is from 2019-12-29 to 2020-01-05, so we re-download the fire data from source website to get the history data
nasa_fire <- readr::read_csv(here::here("data/2020-01-07/fire_archive_M6_147063.csv")) %>% select(-instrument,-type)

# merge two temperature data sets to get final temperature data
temperature_new <- bind_rows(temperature_old, clean_temp_df) 

# merge three rainfall data sets to get final temperature data
rainfall_new<-bind_rows(rainfall_old,clean_rain_df_canberra,clean_rain_df_brisbane)

# write new temperature and rainfall data and rainfall data
write_csv(temperature_new, here::here("data/2020-01-07/","temperature_new.csv"))
write_csv(rainfall_new, here::here("data", "2020-01-07","rainfall_new.csv"))

# Get the new temperature data from 1910-01-01 to 2020-01-05
temperature <- read.csv(here::here("data/2020-01-07/temperature_new.csv"))
rainfall <- read.csv(here::here("data/2020-01-07/rainfall_new.csv"))
```


## Australua fire data

The `fire` data source is from [NASA](https://firms.modaps.eosdis.nasa.gov/download/)[@nasa] "Active Fires Dataset" via the MODIS fire product collection. MODIS active fire product is detected the fire data in every 5 minutes and collected through each tile with horizontal and vertical coordinate. The data contains the fire information of Australia with `r nrow(nasa_fire)` observations from 2000-11-01 to 2020-01-05. The variables information included in the data are as the following table:

```{r fire-data, message=FALSE}
fire_data <- data.frame(
  Variable = c("latitude", "longitude", "brightness", "scan", 
               "track", "acq_date", "act_time", "satellite", 
               "confidence", "version", "dbright_t31","frq", "day_night"),
  Description = c("Center of 1km fire pixel but not necessarily the actual location of the fire as one or more fires can be detected within the 1km pixel.", 
                  "Center of 1km fire pixel but not necessarily the actual location of the fire as one or more fires can be detected within the 1km pixel.", 
                  "Channel 21/22 brightness temperature of the fire pixel measured in Kelvin.", 
                  "The algorithm produces 1km fire pixels but MODIS pixels get bigger toward the edge of scan. Scan and track reflect actual pixel size.", 
                  "The algorithm produces 1km fire pixels but MODIS pixels get bigger toward the edge of scan. Scan and track reflect actual pixel size.",
                  "Date of MODIS acquisition.",
                  "Time of acquisition/overpass of the satellite (in UTC).",
                  "A = Aqua and T = Terra.",
                  "This value is based on a collection of intermediate algorithm quantities used in the detection process. It is intended to help users gauge the quality of individual hotspot/fire pixels. Confidence estimates range between 0 and 100% and are assigned one of the three fire classes (low-confidence fire, nominal-confidence fire, or high-confidence fire).",
                  "Version identifies the collection (e.g. MODIS Collection 6) and source of data processing: Near Real-Time (NRT suffix added to collection) or Standard Processing (collection only). '6.0NRT' - Collection 6 NRT processing.'6.0' - Collection 6 Standard processing. Find out more on collections and on the differences between FIRMS data sourced from LANCE FIRMS and University of Maryland.",
                  "Channel 31 brightness temperature of the fire pixel measured in Kelvin.", 
                  "Depicts the pixel-integrated fire radiative power in MW (megawatts).",
                  "D = Daytime, N = Nighttime"))

fire_data %>%
  kable(caption = "Australia fire data") %>%
  kable_styling(bootstrap_options = "striped", 
                full_width = F, 
                position = "left")
```


## Climate data

For climate data, temperature and rainfall was gathered from the Australian [Bureau of Meterology (BoM)](http://www.bom.gov.au/?ref=logo), of which is used the weather station to measure a variety of aspects of the weather. 
The `Rainfall` data was sourced from six major Australian cities: Perth, Adelaide, Melbourne, Sydney,Brisbane and Canberra, and the cleaned data is obtained from [GitHub tidytuesday](https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-07/rainfall.csv), which is from 1858-01-01 to 2020-01-06, containing more than 230,000 observations.In order to maintain the complete information in six cities, we expand the information for Brisbane and Canberra from the [source website](http://www.bom.gov.au/climate/data) and cleaned them to obtain the data from 1968-01-01 to 2017-12-31 in Canberra and from 1893-01-01 to 1998-12-31 in Brisbane. The new rainfall data is constructed by the old one and supplemental one and then become the final rainfall data set.
The `temperature` data is divided into two parts, with the cleaned data obtained directly from [GitHub tidytuesday](https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-07/temperature.csv), which is from 1910-01-01 to 2019-05-31. And we found the time range of the cleaned `temperature` data cannot match the `fire` data, in order to further analysis of the relationship between the fire and the temperature, we decided to download the new temperature data from the [source website](http://www.bom.gov.au/climate/data/index.shtml??zoom=1&lat=-26.9635&lon=133.4635&layers=B0000TFFFFFFFFFTFFFFFFFFFFFFFFFFTTT&dp=IDC10001&p_nccObsCode=201&p_display_type=dailyDataFile), and cleaned it to obtain the new data from 2019-06-01 to 2020-01-05. Finally, the new data were merge with the Github data to produce a final `temperature` data from 1910-01-01 to 2020-01-05,consisting of more than 530,000 observations. Also, there are seven weather stations were chosen, based on seven Australian cities such as  Perth, Adelaide, Melbourne, Sydney, Brisbane, Port Lincoln and Canberra.  

The climate data structure is shown as the below tables.

```{r temp-data, message=FALSE}
temperature_data <- tibble(Variable = c("city_name", "date", "temperature", "temp_type", "site_name"),
                          Class = c( "character",  "double", "double","character", "character"),
                          Description = c("City Name", 
                                          "Date", 
                                          "Temperature in Celsius", 
                                          "Temperature type (min/max daily)", 
                                          "Actual site/weather station")) 
temperature_data %>%
  kable(caption = "Temperature data") %>%
  kable_styling(bootstrap_options = "striped", 
                full_width = F, 
                position = "left")
```

```{r rainfall-data, message=FALSE}
rainfall_data <- data.frame(Variable = c("station_code",
                              "city_name",
                              "year",
                              "month",
                              "day",
                              "rainfall",
                              "period",
                              "quality",
                              "lat",
                              "long",
                              "station_name"),
                          Class = c("character", "character", "double",
                                    "character","character", "double", 
                                    "double","character","double","double", "character"),
                          Description = c("Station Code",
                                          "City Name", 
                                          "year",
                                          "month",
                                          "day",
                                          "Trainfall in millimeters", 
                                          "how many days was it collected across",
                                          "	Certified quality or not",
                                          "latitude",
                                          "longitude",
                                          "Station Name")) 
rainfall_data%>%
  kable(caption = "Rainfall data") %>%
  kable_styling(bootstrap_options = "striped", 
                full_width = F, 
                position = "left")
```

# Analysis and findings

[FILL] Should include at least one plot or numerical summary for each of your questions, that helps the reader arrive at an answer. You should also write paragraphs describing the methods, summaries and findings.

## When were the most fires burning ?

In this part, we will focus on the relationship between fire number and the time, We analyzed the fire data of the past ten years and got the total number of living in 12 months of each year, the graph shows below.

```{r when,fig.cap="The number of Australia fire in 12 month between 2001 and 2020"}

data_fire_Year <- nasa_fire %>% 
  
  mutate(acq_date = as.POSIXlt(acq_date)) %>% 
  mutate(Year =year(acq_date),Month = month(acq_date)) %>% 
  mutate(Year = factor(Year)) %>% 
  group_by(Year,Month)%>% 
  summarise(total = n()) 

p1 <- data_fire_Year %>% 
  mutate( highlight=ifelse(Year=="2019", "2019", "Other")) %>% 
  ggplot( aes(x=Month, y=total, group=Year, color=highlight, size=highlight)) +
  scale_x_continuous(breaks = seq(1, 12, by = 1))+
  geom_line()+
  geom_label( x=4.5, y=2000, label="Other years,2001 to 2018", size=2, color="#69b3a2")+
  geom_label( x=11.5, y=90000, label="2019", size=3, color="#69b3a2")+
  geom_label( x=8.5, y=115000, label="2011", size=3, color="#69b3a2")+
  scale_color_manual(values = c("#69b3a2", "grey")) +
    scale_size_manual(values=c(1.5,0.2)) +
    theme(legend.position="none") +
    # ggtitle("The number of Australia fire in 12 month between 2001 and 2020") +
  theme(
                  axis.text.y = element_text(color = "grey", 
                                             face = "bold"),
                  plot.title = element_text(face = "bold"),
                  plot.background = element_rect(fill="white"),
                  panel.background = element_rect(fill="white"))
 
p1
```
Figure ref\@{figure:when} represent the changing trend of the total number of fires from 2001 to 2020. From this figure, there are three unusual phenomena.

Firstly, Why is the fire trend in 2019 different from other years? we can know that 2019-fire is the largest fire in Australia's temperate forests since European settlement[@nolan2020causes], why it happens? This is because before and during the current fire season, eastern Australia has been suffering from severe drought. In particular, in the six months ending November 30, 2019, most of the northeastern part of New South Wales had the lowest rainfall in history and the temperature was above average.


Secondly, Why is the number of fires from August to November significantly higher than in other months? Is it because of the temperature? August to November is Australia's winter and spring. The average temperature is not particularly high, but fall and winter bring drier weather, making the grass dry and ready to catch fire[@sullivan2012fuel]. Is it also because of rainfall? We drew a figure ref\@{figure:rain} of the average rainfall of different months between 2001 and 2020. It is obvious that September and October are the months with the least rainfall, and August and November are not particularly rainy, so August to November, One of the reasons for the high number of wildfires relative to other months is the low rainfall.

```{r rain, fig.cap ="Average rainfall in different months"}
rain_agv <- rainfall %>% 
  filter(year> "2001") %>% 
  #mutate(date = as.Date(date)) %>% 
  #mutate(Month = month(date)) %>% 
  group_by (month) %>% 
  #filter(Month ==c(8:11)) %>% 
  summarise(mean_rain= mean(rainfall,na.rm=TRUE)) %>% 
  arrange(mean_rain)
  
  rain_agv %>%
 # filter(!is.na(Value)) %>%
  arrange(mean_rain) %>%
  mutate(month=factor(month, month)) %>%
  ggplot( aes(x=month, y=mean_rain) ) +
    geom_segment( aes(x=month ,xend= month, y=0, yend=mean_rain), color="grey") +
    geom_point(size=3, color="#69b3a2") +
    coord_flip() +
    #theme_ft_rc() +
    theme_ipsum() +
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="none"
    ) +
    xlab("Month")
```

Lastly, Why did September with the highest number of fires occur in 2011? This is because the fire swept through the Barkley Plateau and the Victoria River area, destroying large areas of grazing land. According to the report, the fire front is estimated to be 50 kilometers (31 miles); the Barkley fire caused 7,000 square kilometers (2,700 square miles) to be burned in the country, and the Victoria River area lost 2,000 square kilometers (770 square miles). At the same time, 30 grass fires broke out in Kimberley. Several other fires burned in Kimberley, causing the loss of 60,000 hectares (150,000 acres) of grassland. (source: https://en.wikipedia.org/wiki/2011%E2%80%9312_Australian_bushfire_season#cite_note-3)



## What locations the most widespread fires burning?

Wildfires in Australia have always existed for the past ten years. In this section, we will focus on the relationship between wildfires and geographic locations. Because the data downloaded from NASA does not contain information about the specific state of each wildfire, so I will first divide data into different states according to the latitude and longitude. Since the borders of New South Wales and Victoria are not easily distinguished, putting these two states together, we can finally get the wildfire situation in different states in the past ten years.

```{r state,fig.cap=" The number of wildfire in different states in the past ten years"}

WA_fire <- nasa_fire %>% 
  filter(longitude < 128) %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "WA")

NT_fire <- nasa_fire %>% 
  filter(longitude < 138, latitude < '-25')  %>% 
  filter(128<longitude) %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "NT") 

SA_fire <- nasa_fire %>% 
  filter(longitude < 141, latitude > '-25')  %>% 
  filter(128<longitude) %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "SA") 

QLD_1 <- nasa_fire %>% 
  filter(longitude > 141, latitude < '-25')  %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "QLD") 

QLD_2  <- nasa_fire %>% 
  filter(longitude > 141, latitude < '-29')  %>% 
  filter(latitude >'-26') %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "QLD")


VIC_NSW  <- nasa_fire %>% 
  filter(longitude > 141, latitude > '-29')  %>% 
  mutate(Year = year(acq_date)) %>% 
  mutate(state = "VIC_NSW") 

state_fire <- bind_rows(WA_fire,NT_fire,SA_fire,VIC_NSW ,QLD_1,QLD_2) %>% 
  group_by (state,Year) %>% 
  summarise(total= n())
ggplot(state_fire,aes(x = Year,y = total)) +
  geom_col(color = "#69b3a2")+
  facet_wrap(~state)+
   theme(axis.text.y = element_text(color = "grey", 
         face = "bold"),
        plot.title = element_text(face = "bold"),
         plot.background = element_rect(fill="white"),
        panel.background = element_rect(fill="white"))
 
```
The fig\@{figure:state} clearly shows the largest number of fires almost happen in the Northern Territory and Queensland, one of the reasons is because the Northern Territory and Queensland have more forests. When it comes to the VIC_NSW, Since 2001, the number of fires has remained the same overall, except for 2019, which the number of fires has  When we focus on the year of 2019, we can see that, in some regions, the data in 2019 is indeed slightly higher than the surrounding years, the reason will explain in next part.


















